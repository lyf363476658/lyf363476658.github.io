<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zentia.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"W8FJT5MTZU","apiKey":"f4ca7ae2408d2e27ffc8269ad8d34273","indexName":"hexo","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="liyanfeng">
<meta property="og:url" content="http://zentia.github.io/page/8/index.html">
<meta property="og:site_name" content="liyanfeng">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="liyanfeng">

<link rel="canonical" href="http://zentia.github.io/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>liyanfeng</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">liyanfeng</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/11/zbrush/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/11/zbrush/" class="post-title-link" itemprop="url">ZBrush Manual</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-11 10:14:20" itemprop="dateCreated datePublished" datetime="2019-05-11T10:14:20+08:00">2019-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ZBrush/" itemprop="url" rel="index"><span itemprop="name">ZBrush</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="常用快捷键"><a href="#常用快捷键" class="headerlink" title="常用快捷键"></a>常用快捷键</h1><p>空格键 激活鼠标指针下的菜单（按住不放再拖拉鼠标指针可定位文档）<br>左键在空白处单击并拖动＝旋转视角<br>alt建＋左键在空白处单击并拖动＝平移视角<br>alt键＋左键然后放开alt键在空白处拖动并平移＝缩放视角 </p>
<ul>
<li>放大文档 </li>
</ul>
<ul>
<li>缩小文档<br>0（零） 查阅文档的实际大小<br>旋转中配合 shift ，捕捉在正交视点处<br>旋转中配合 ALT ，以相对平滑方式旋转视图<br>按下 DEL ，可以将物体在画布中最大化显示<br>Ctrl+0 查阅文档实际大小的一半，抗锯齿（还影响输出）<br>ctrl+shift+拖动=未选中的部分将隐藏。<br>ctrl+shift+点击空白处=恢复显示<br>ctrl+shift+拖动+释放（ctrl、shift）=选中的部分将隐藏<br>Ctrl+f 用当前texture填充canvas当前layer<br>Ctrl 遮罩功能<br>Ctrl+d 细份一次<br>Tab 隐藏/显示浮动调控板<br>H 隐藏/显示Zscript窗口<br>C 在指针下面拾取颜色<br>S 绘图大小<br>I RGB强度<br>Shift+I Z强度<br>Shift+d 绘制贴图的时候让模型上的网格线隐藏<br>Q 绘图指示器（默认为所有工具）<br>W 移动模式<br>E 缩放模式<br>R 旋转模式<br>T 编辑模式<br>Shift+s 备份物体<br>M 标记物体<br>点中marker ctrl+M 取消标记<br>Ctrl+Z 撤销<br>Shift+Ctrl+Z 重做<br>Alt/Option 影响转换大多数工具<br>G 打开Projection Master<br>Alt+A Alpha调控板<br>Alt+C Color颜色调控板<br>Alt+T tool调控板<br>Alt+T Transform调控板<br>Alt+R Render调控板<br>Alt+鼠标左 绘图模式下可以删除Z求点 </li>
</ul>
<p>Shift+crease———————crease everything<br>Shift_uncrease——————uncrease everything<br>A —————————zSphere to Z mesh<br>ctrl+N ————————- clear the layer</p>
<h1 id="笔刷"><a href="#笔刷" class="headerlink" title="笔刷"></a>笔刷</h1><ol>
<li><strong>Standard(标准笔刷)</strong>:使用Standard笔刷进行雕刻的时候,我们可以塑造出截面为半椭圆形的突起,如图所示<img src="/2019/05/11/zbrush/1.webp"></li>
<li><strong>Smooth(光滑笔刷)</strong>:在选择任何笔刷的情况下,按住Shift键,都会切换到Smooth笔刷,该笔刷可以使物体避免的形状进行融合,进而雕刻出较为平滑三维表面,如图所示<img src="/2019/05/11/zbrush/2.webp"></li>
<li><strong>Move(移动笔刷)</strong>:Move和Standard不同,不能对物体表面进行连续的形变,每次只能对不大于笔刷大小的区域进行锥拉操作,如图所示,但是Move在对形体进行调整时,有非常良好的表现<img src="/2019/05/11/zbrush/3.webp"></li>
<li><strong>Clay(粘土笔刷)</strong>:Clay与ClayTubes和ClayBuildup笔刷一样,属于粘土类型的笔刷,该中类型的笔刷雕刻起来感觉类似传统的泥塑,就像用泥巴一层一层的添加结构,它是应用最广发的笔刷之一.</li>
<li><strong>Clay Tubes(粘土管笔刷)</strong>:此笔刷可以作为Clay的变种笔刷,由于加载了方形的Alpha,所以在塑造形体的时候,边缘更清晰,而且有层次感.</li>
<li><strong>Clay Buildup(粘土堆积笔刷)</strong>:同ClayTubes笔刷相比,ClayBuildup笔刷更细腻,凹起程度也更高.不同的是,Clay和ClayTubes在雕刻时会使形体产生平坦的突起,但是ClayBuildup会产生边界较为锐利但表面弧状的突起.<img src="/2019/05/11/zbrush/4.webp"></li>
<li><strong>Dam Standard</strong>:给人感觉用刀雕刻的感觉。<img src="/2019/05/11/zbrush/1.jpg"></li>
<li><strong>HPolish Brush</strong>可以画出坚硬的牙齿效果。</li>
<li><strong>Slash3</strong></li>
</ol>
<p>Tray是用来放置菜单的.<br>Canvas<br>Light Box<br>Shelf<br>Brush<br>Project位于上面的File菜单中.也可以通过快捷键Ctrl+S访问这个选项,这样就可以保存好一个Project了,Project中可以保存全部的Tools.可以将其中所有的Tools都保存好.也可以保存好对材质面板的改变.以及Render面板中的一些设置和Light面板中的一些设置.一定要记住Project中保存了所有的Tools<br>Tool</p>
<h1 id="快捷键操作"><a href="#快捷键操作" class="headerlink" title="快捷键操作"></a>快捷键操作</h1><p>摁住Alt鼠标左键点击空白处移动,可以移动画面.<br>默认外拉面数,Alt内推面数<br>Zadd,Zsub<br>Zadd是所有笔刷默认使用的模式,不是所有的笔刷,你只要按Alt就可以切换到Zsub模式,向内雕刻模型,<br>摁住Shift你会注意到,鼠标光标会变成蓝色,现在处于Smooth Brush模式,你可以使模型表面变得平滑<br>Smoothey Intelligently<br>Clay笔刷不用理会拓扑结构是怎样的.无论是光滑的还是凹陷的结构.它与拓扑结构无关.<br>Ctrl添加Mask，Ctrl+Alt消除Mask<br>做耳朵技巧：先用Mask画出一个耳朵，然后更改画刷为Move，然后修改细分，然后拉出一只耳朵来。<br>单独按D键，可以向上移动一个层级<br>Deformation<br>Smart ReSym</p>
<h1 id="设置快捷键"><a href="#设置快捷键" class="headerlink" title="设置快捷键"></a>设置快捷键</h1><p>1键切换到标准笔刷，2键切换到Move笔刷，3键表示Clay4，4键表示Tray Dynamic，5键表示Clay Buildup<br>在Deformation(变形工具)中可以调整Inflate（充气）选项。让模型变得臃肿。Inflate Balloon(快速充气)注意这个选项运算量很大，所以最好修改一下细分。</p>
<ol>
<li><strong>Polish</strong>：磨光</li>
<li><strong>Polish Grisp Edge</strong></li>
</ol>
<p>Masking(遮罩工具)</p>
<ol>
<li><strong>Mask By Cavity</strong>对内向的地方进行了遮罩。</li>
</ol>
<p>Sub Tool<br>Sphere3D制作头发<br>Geometry<br>DynaMesh<br>Resolution 128<br>Transparency<br>Ghost</p>
<p>Can’t adjust divide<br>Try use Dynamesh,but this operator may be make your mode have a few of triangle.</p>
<p>|快捷键|说明|<br>|Ctrl+Shift+Alt然后框选物体|剪切掉框选的物体|<br>|Ctrl+Shitf然后框选物体|剪切掉除了框选之外的物体|</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/11/3dmax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/11/3dmax/" class="post-title-link" itemprop="url">3DMAX Manual</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-11 10:10:32" itemprop="dateCreated datePublished" datetime="2019-05-11T10:10:32+08:00">2019-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:37" itemprop="dateModified" datetime="2021-06-17T10:39:37+08:00">2021-06-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/3DMax/" itemprop="url" rel="index"><span itemprop="name">3DMax</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="工具栏"><a href="#工具栏" class="headerlink" title="工具栏"></a>工具栏</h1><p>主工具栏（Main Toolbars）:按ALT+6可以进行隐藏/显示，其他工具栏可以选择菜单<br>Customize\Show UI(自定义\显示用户界面)进行显示在屏幕上。</p>
<h1 id="工作视图"><a href="#工作视图" class="headerlink" title="工作视图"></a>工作视图</h1><ol>
<li>视图切换可直接按快捷键的有： T—Top（顶视图）、B—Bottom（底视图）、F—Front（前视图）<br>L—Left（左视图）、U—User（用户视图）、P—Perspective（透视图）<br>C—Camara（摄像机视图，只有建立摄像机后才有用）<br>Shift+移动——复制<br>MAX安全框 快捷键 显示/隐藏安全框 <code>Shitf+F</code>, 防止相机打出去的<br><code>Shift+Q</code>——渲染当前视图<br><code>Alt+X</code>使选中物体透明</li>
</ol>
<p>其他不能按快捷键的操作如下：</p>
<ul>
<li>激活视图，按V键，从快捷菜单中进行选择</li>
<li>在视图名称处按右键选择Views(查看)命令后面的相应视图</li>
</ul>
<ol>
<li>视图中的物体显示方式<br>Wireframe（网格）：以物体颜色显示网格，材质不显示<br>Smooth+HighLights（实体）<br>以上两种可以按F3进行切换<br>Other后面的有<br>Smooth（光滑）：只进行光滑显示，不会显示高光<br>Facets+Highlights：显示面状+高光，不进行光滑显示<br>Facets:只按面状显示<br>Lit Wireframe：以材质标准方式显示网格，与物体颜色设置无关<br>Bounding Box：边界盒子，按物体最大体积边界方盒显示，这种方式视图刷新最快<br>Facets Edges:按网格和实体同时显示，可按F4进行切换<br>Alt+X—将物体按透明方式显示</li>
<li>改变视图大小<br>将鼠标置于视图窗口交界出拖动即可任意改变视图大小，还原时在窗口边界处按右键，选择Rest Layout<br>（重新恢复布局）命令即可。<br>单独放大某个视图：按Alt+W键，再次使用还原。</li>
<li>隐藏/显示视图网格—按G键</li>
<li>视图布局<br>选择菜单Customize\Viewport Configration(自定义\视图配置)命令，选择Layout（布局）选项</li>
<li>视图布局风格<br>选择菜单Customize\Lode Custom UI Scheme(自定义\装载自定义用户界面方案)命令<h1 id="鼠标操作"><a href="#鼠标操作" class="headerlink" title="鼠标操作:"></a>鼠标操作:</h1>直接按”中键”—平移视图<br>Alt+”中键”—按任意角度旋转视图<br>Ctrl+Alt+”中键”—缩放视图<br>Shift+Alt+”中键”—水平或垂直旋转视图<br>五、命令面板（Command Panal）<br>最顶上一排图标分别表示Create(创建)、Modify（修改）、Hiaracher（层级）、Motion（运动）、Display（显示）、Utilities（实用程序）<br>六、其他（轨迹栏、状态栏、提示栏、动画播放区等）略<br>先左键后右键，取消当前选择。<br>复制，整列复制。<br>Ctrl+V：复制，实例，参考。<br>复制：复制出来的物体与原物体没有任何关系<br>实例：相互影响，不管是修改实例。<br>参考：参考物体时不具有属性的，无法修改参考属性。<br>Z键：将选择物体最大化显示<br>修改器列表:<br>Bend<br>中心:修改弯曲轴<br>弯曲<br>角度,弯曲多少度<br>方向:<br>弯曲轴:以哪个方向为弯曲轴<br>限制:某一部分不进行弯曲.<br>上限:轴心0点以上<br>下线:轴心0点以下<br>显示最终结果打开<br>Show end result<br>锥化命令(Taper)<br>数量(Amount)如果为整数上面放大<br>曲线(Curve)中间凸起<br>锥化轴(Taper Axis)<br>主轴(Primary)<br>效果(Effect)<br>限制(Limits)<br>限制效果(Limit Effect)<h1 id="扭曲-制作冰激凌"><a href="#扭曲-制作冰激凌" class="headerlink" title="扭曲()-制作冰激凌"></a>扭曲()-制作冰激凌</h1></li>
</ol>
<p>晶格(Lattice)-制作纸篓:运用边生成三维模型<br>应用整个对象(Apply to Entire Object)<br>忽略隐藏边(Ignore Hidden Edges)<br>末端封口(End Caps)<br>基点面类型(Geodeisic Base Type)<br>四面体(Tetra)<br>八面体(Octa)<br>二十面体(Icosa)</p>
<h1 id="选择操作"><a href="#选择操作" class="headerlink" title="选择操作"></a>选择操作</h1><p>1、多选物体：<br>A:按Ctrl键增加物体选择，按Alt键减少物体选择<br>B：框选，有矩形、圆形、多边形、套索四种范围<br>2、编辑菜单中的几个选择命令：<br>Select Invert(反选)（ctrl+i）、Select by Color(按颜色选择)、Select by name(按名称选择)<br>3、工具菜单中的选择命令：<br>Isolate Selection:单独显示被选择的物体（alt+q ），自动隐藏其他物体（非选择）<br>关闭Isolate Selection警告对话框进行还原。<br>4、命名选择集合<br>实例：台球桌物体的操作</p>
<h1 id="复制操作"><a href="#复制操作" class="headerlink" title="复制操作"></a>复制操作</h1><ol>
<li>使用菜单Edit\Clone（编辑\克隆）命令。<br>2、使用变换工具进行复制（移动、旋转、缩放）<br>3、使用镜向工具复制<br>三、变换操作<br>1、移动：移动控制轴由两两垂直的三个单向轴组成，显示为红、绿、篮颜色的三个轴向分别代表X、Y、Z方向，<br>操作时既可单独锁定控制轴进行单轴方向上的移动，也可将</li>
</ol>
<p>鼠标定在靠近两轴交点的黄色平面区域<br>内按平面的方式进行任意移动。<br>2、旋转：旋转物体时，其外围会出现三个球形控制轴，显示为红、绿、蓝圆弧线条的为单向旋转轴，<br>分别代表X、Y、Z三个轴向，当前操纵的轴向会显示为黄色；内圈的灰色圆弧可以进行空间上的旋转，<br>可将物体在三个轴向上同时进行旋转；外圈的灰白色圆弧可以在当前视图角度的平面上进行旋转。<br>3、缩放：5.0版对缩放控制轴做了很大改进，可以直接在控制轴上实现等比和非等比操作，<br>其控制轴呈三角形，显示为红、绿、蓝箭头轴向为单向缩放轴，分别代表X、Y、Z三个轴向。<br>操作时拖动内部中心的三角区域可以进行等比例缩放；拖动单个轴向，可以进行单方向上缩放；<br>拖动外侧的三角平面可以进行双方向上的同时缩放。<br>四、实例：<br>1、使用局布（Local）坐标系统移动斜波物体。<br>2、复制西餐椅子（可使用移动、旋转、镜向工具完成）<br>3、复制石凳（使用旋转工具）<br>要点：A：移动和对齐轴心点；B：捕捉角度</p>
<p>第三讲<br>一、复习<br>二、群组操作<br>Group（成组）：将多个选择的物体组成一个组<br>Ungroup（解组）：将群组解散，一次只能解散一个组<br>Open（打开组）：打开的组仍然存在，可以对组中的单个成员进行编辑<br>Close（关闭组）：将打开的组关闭，保持原来的组名<br>Detach（分离组）：将选择的组从当前的组中分离出去</p>
<p>Attach（合并组）：对两个或两个以上的组组合成一个新的组。<br>Explode（炸开组）：对当前选择的组进行炸开操作，可将多个组一次解散。<br>三、阵列操作<br>1、阵列对话框参数解释<br>Incremental（增量）：表示每两个物体之间的变换量，使用Move表示为距离，使用Rotate则表示角度，<br>使用Scale表示缩放变比。<br>Tatols（总量）：表示所有物体之和的总量，使用Move表示为距离，使用Rotate则表示角度，<br>使用Scale表示缩放变比。<br>Uniform:勾选此项，将锁定Scale变比设置，只能等比缩放。<br>1D、2D、3D分别表示在一维、二维、三维空间上产生阵列，Count表示物体的复制数目。<br>Incremental Row Offsets:制作二维、三维阵列时相对于一维阵列X、Y、Z轴上的偏移量。<br>Reset all parameters可以恢复对话框中的默认参数设置<br>2、实例：<br>A：制作圆形环绕的石凳</p>
<p>B：制作旋转台阶（特别注意台阶物体的轴心点位置）<br>四、对齐操作<br>先选择被对齐的原物体，单击工具栏中的对齐按钮，在视图中点击目标对齐物体<br>， 依据对话框可以实现原物体与目标物体以下几种对齐方式：<br>Minimum（最小对齐）:在正交视图物体的最左端和最下端分别定义X、Y轴的最小值。<br>Center(中心)：以物体的重心位置进行对齐<br>Pivot Point（轴心点）：以物体的坐标轴位置进行对齐<br>Maximum（最大值）：在正交视图物体的最右端和最上端分别定义X、Y轴的最大值。<br>第四讲 </p>
<ol>
<li>Box（方体）<br>Length、Width和Height分别定义方体的长度、宽度和高度，Length Segs、</li>
</ol>
<p>Width Segs和Height Segs分别定义长度、宽度和高度的分段划分，增加它们的值则产生栅格方体，<br>配合修改器的使用可以使方体更易于变形，从而产生形态各异的几何物体<br>2.Sphere(球体）<br>Radius（半径）：定义球体的大小。<br>Segments（分段数）：该值越大，球越圆滑。<br>Smooth（光滑）：控制球体表面是否光滑。<br>Hemisphere（半球）：值域为0-1，值为0时，表示一个完整的球体，值为1时，整个球体收缩成一个点，<br>值介于0-1之间，球体变为球冠，仅当值为0.5时为半球。<br>Chop（剪切）：在半球或球冠时，将整个球体的水平分段数切掉一半<br>Squash（挤压）：在半球或球冠时，可将下半球被切掉的球体水平分段数挤压到上半球，仍保持完整的分段数。<br>Slice On（切片）：打开它可以在下面的设置中调节球体局部切片大小。<br>Slice From/Slice To（切片开始/切片结束）：分别设置切片两端切除的幅度<br>Base To Pivot：设置球体的轴心点在球体的底部还是在球心位置。</p>
<p>Generate Mapping Coordinates（产生贴图坐标）：自动产生贴图坐标。<br>3.Geosphere(几何球体）<br>Tetra（四面体）/Octa（八面体）/Icosa（二十面体）：这三个参数分别控制该球体的基本类型，它们与Segments<br>参数值的平方值相乘正好是几何球体的所有三角面的个数，直<br>接在选择的物体上按数字键7，视图中会显示物体所有面的数量</p>
<ol>
<li>Cylinder(柱体)<br>Radius（半径）：控制圆柱体的粗细。<br>Height（高度）：可以控制圆柱体的高矮。<br>Height Segments（高度分段数）：分段越多，物体精度越高，表面则越光滑<br>Cap Segments（端面分段数）：定义圆柱体截面圆形的分段数，从顶端截面看就是一个个同心圆。<br>Sides（边数）：定义圆柱体侧面的分段划分，值越大，圆柱体越圆。</li>
<li>Cone(锥体)<br>Radius 1/Radius 2分别控制锥体的上下两个端面的半径大小，当其中的一个值为0时即为锥体，<br>当两个半径值不为0且不相等时为圆台物体，当两个半径不为0且相等时则变为柱体。</li>
<li>Tube(圆管)<br>Radius 1/Radius 2分别控制圆管的内径和外径的大小。</li>
<li>Torus(圆环)<br>Radius 1：表示自圆环的中心至截面正多边形的中心距离。<br>Radius 2：表示圆环截面正多边形的内径大小，用它可定义圆环的粗细。<br>Rotation（旋转）：设置每一片段截面沿圆环轴旋转的角度<br>Twist（扭曲）：设置每个截面扭曲的角度，产生扭曲的表面。<br>扭曲角度,扭曲偏移Bias<br>扭曲轴,限制,上下限制扭曲.<br>Segments：沿着圆环长度上的分段数，值越大，得到的圆形越光滑。<br>Sides：圆环截面的边数，值越大，圆环越圆滑。<br>Smooth：设置圆环光滑范围，有All（全部光滑）、Sides（边光滑）、None（所有不光滑）和Segments（沿着长度光滑）四种类型。</li>
<li>Teaport（茶壶）<br>Radius（半径）：用于控制茶壶的大小。<br>Segments（分段数）：增加此值，可使茶壶变得更加圆滑。<br>Teapot Parts：该选项中的四个参数分别控制是否要茶壶的Body（壶身）、Handle（壶柄）、Spout（壶嘴）和Lid（壶盖）</li>
<li>Pyramid（四棱锥）</li>
</ol>
<p>产生类似金字塔状的四棱锥体，调节Width、 Depth和 Height参数可以改变四棱锥的宽度、深度和高度。</p>
<ol>
<li>Plane(平面)<br>Length和Width确定平面的大小。<br>Scale（比例）:控制平面在渲染时可以按一定的比例倍数进行放大或缩小；<br>Density（密度）:参数可以使平面增加更多面的划分，当加大此值时，可以从Total Faces<br>（总面）参数中获得相关信息。<br>FFD-制作苹果<br>通过控制点<br>FFD2<em>2</em>2<br>控制点(Control Points)<br>晶格(Lattice)<br>设置体积(Set Volume):这个晶格点是放在哪个位置上</li>
</ol>
<p>第五讲 </p>
<ol>
<li>Hedra（异面体）<br>Family（类型）：即Tetra（四面体）、Cube/Octa（立方体/八面体）、Dodec/Octa（十二面体/二十面体）、Star1（星形1）和Star2（星形2）。<br>Family Parameters（类型参数）：参数P和Q，取值范围从0.0到1.0，修改它们的值可以控制组成异面体的多边形的形状。<br>Axis Scaling（轴向比率）：P、Q、R分别调节各种多边形的轴向比率。如果异面体只有一种或两种类型的面，那么轴向比率参数也只有一项或两项有效<br>无效的比率不产生效果。<br>Reset（重设置）:单击此按钮恢复轴向的初始设置。<br>Vertices（顶点）：确定异面体内部顶点的分布情况，从而决定异面体的内部结构。其中Basic表示超过最小值的面不再进行细划分；Center表示在面的中心位置添加一顶点，<br>按中心点到面的各个顶点所形成的边进行细划分；Center &amp; Sides表示在面的中心位置添加一枯点，按中心点到面的各个顶点和边中心所形成的边进行细划分，所产生的面比<br>Center方式多一倍。</li>
<li>Turus Knot（环形节）<br>Base Curve（基本曲线）：提供两种基本曲线类型：Knot（节）和Circle（圆形）。当选择Knot类型时，激活其下的P和Q参数；当选择Circle类型时，激活Warp Count和Warp<br>Height参数。<br>Radius：定义环形节物体的半径大小，在Cross Section子面板中也有一个Radius，它是定义环形节物体的截面半径大小。<br>P和Q：表示在水平方向和垂直方向产生打节的数目，当这两个值相等时，均为一个不打节的圆环，当其中的一个值为小数时，是一个断裂的圆环。<br>Warp Count（扭曲数目）：表示在环形物体上突出的扭曲角的数目，最大值为100。<br>Warp Height（扭曲高度）：表示扭曲角突出的程度，最大值为4。<br>Cross Section（横截面）：定义环形节物体横截面的形态。<br>Sides（边）：环形节截面的段数，值越大越圆滑。<br>Eccentricity（偏心率）：设置环形节压扁的程度，该值越接近1，其截面就越接近圆形。<br>Twist（扭曲）：设置截面沿路径扭曲旋转的程度，一般取消Smooth（光滑）选项后观察比较明显。<br>Lumps（肿块）：设置此值，可以使环形节产生一定数量的肿块效果。<br>Lumps Height：设置肿块的高度，最大值为4。<br>Lumps Offset：设置肿块在路径上移动的偏移量。<br>Smooth（光滑）：设置环形节表面按哪种方式进行光滑，All、Sides和None分别表示对整个造型进行光滑、沿路径方向的面进行光滑和不进行光滑处理。<br>Mapping Coordinates（贴图坐标）：设置贴图坐标及贴图图像在当前物体U、V方向的偏移量和平辅次数。</li>
<li>ChamferBox（倒角方体）<br>有两个参数用于设置倒角值，Fillet设置倒角的大小，当值为0时，就变为Box了；Fillet Segments用于设置倒角的分段数。这两个值要配合使用，如果Fillet Segments值设置<br>过小，很难体现倒角的圆滑度。 </li>
<li>ChamferCyl（倒角圆柱体）<br>与标准几何体中的圆柱体相似，所不同的是在圆柱体的两个端面与侧面之间可以产生圆滑的倒角效果,Fillet和Fillet Segments，含义与ChamferBox中的参数含义相同</li>
<li>OilTank（油罐）、Capsule（胶囊体）、Spindle（纺锤体）<br>这三个扩展几何体工具属于同类型的，共同点是中间都是圆柱体，只是顶端形状不一样，控制参数也大同小异，大部分参数项与圆柱体相同。<br>Blend（融合）参数设置油罐圆柱部分与其顶盖部分的倒角程度，使其互相交融，产生圆滑效果。Overall与Center用来定义油罐的高度，使用Overall包括上下两个顶盖的高度<br>和油罐中间圆柱的高度，使用Center仅指中间圆柱部分的高度。</li>
<li>Gengon（多边形棱体）<br>使用Gengon（多边形棱体）命令可以创建多边形柱体，修改Fillet参数值还可以使多边形柱体的每个侧面交界处产生光滑的倒角。</li>
<li>L-Ext（L型物体）与C-Ext（C型物体）<br>使用L-Ext和C-Ext命令可以创建表现L型和C型实体模型，主要用来表现建筑中的墙体效果</li>
<li>RingWave（环形波）<br>Radius（半径）：设置环形波的外沿半径。<br>Radius Segs（半径分段数）：设置内沿半径与外沿半径之间的分段数。<br>Radius Width（环形宽度）：设置从外沿半径向内的环形宽度的平均值。<br>RingWave Timing（环形波定时）：主要用于设置环形波的运动形式，主要有三种：<br>No Growth（没有增长）：环形波在生成过程始终以静态方式显示出来，不能形成动画。<br>Grow and Stay（增长并保持）：环形波生长过程中逐渐放大，到达最大时就停止放大，直至运动到最后一帧，其放大及停留的时间可以通过Start Time和Grow Time参数控制。<br>Cyclic Growth（循环增长）：将使环形波在运动过程中以循环方式进行放大显示，循环的次数可以通过Start Time和Grow Time参数进行设置，例如要在100帧的动画中循环5次<br>，可将Start Time设置为0，Grow Time设置为20。<br>Outer Edge Breakup与Inner Edge Breakup：它们的参数项是一样的，修改这些参数可以设置环形波内部和外部波浪的变化形状和大小幅度。分别有一个On复选项，控制其下参<br>数设置是否有效，系统默认激活Inner Edge Breakup控制项，取消该复选项，环形波内部为一圆形，主要参数含义如下。<br>Major Cycles（主圆周期）：定义环形波内部或外部边缘产生波纹的数目。<br>Width Flux（宽度流束）：定义波纹伸展的幅度，以百分比的形式表示。<br>Crawl Time（运动时间）：该值为正值时，环形波按顺时针方向运动，为负值时，按逆时针方向运动。<br>Minor Cycles（次圆周期）：设置此值可以在主圆的外围再产生若干个次圆波纹。</li>
<li>Hose（软管）<br>Hose是一种可以连接两个物体之间的可变形物体，它会随着两端物体的运动而做出相应的反应，从外形看很像一根软管，有圆形、矩形和D形三种外观。软管分自由软管和绑定<br>软管两种，作为捆绑软管可以在其顶部和底部与任何物体进行绑定操作，被绑定物体的轴心点将是软管模型两端的定位点。</li>
</ol>
<p>第六讲 复合物体(COMPOUND OBJECTSOBJECTS))<br>*注意: 1.要有二个或二个以上的物体才能用其命令<br>一.BOOLEAN(布尔计算)<br>1.PICK OPERAND B（拾取操作对象B）<br>1)REFERENCE(将对象B参考复制一个,来进行布尔计算)<br>2)COPY (将对象B复制一个,来进行布尔计算)<br>3)MOVE (将对象B直接来进行布尔计算)<br>4)INSTANCE (将对象B关联复制一个,来进行布尔计算)<br>2.Operation（操作）<br>Union（相加）<br>Intersection（相交）<br>Subtraction（A-B）/Subtraction（B-A）:相减<br>Cut（剪切）<br>Refine（细化，插入一条对象B与对象A相交部分的轮廓线）<br>Split（割裂，把相交部分分为单独的一个次元素对象）<br>Remove Inside（出除里面，删除相交部分，使对象A里面挖空）<br>Remove Outside（出除外面，删除对象A与对象B不相交的部分，<br>相交部分只保留一个面，里面挖空）<br>3.DISPLAY<br>RESULT（显示结果）<br>OPERAND（显示操作对象）<br>RESULT+HIDDEN OPERAND（结果+隐藏的操作对象）<br>4.如何修改原物体参数<br>在OPERAND中选原始物体A或B(MODIFY-OPERANDS A或B)<br>5.几个物体同时挖<br>要求：几个物体用ATTACH(合并)命令使它们作为一个物体<br>第1种：EDIT MESH（编辑网格）-ATTACH LIST<br>第2种：按右键-CONVERT TO-CONVERT TO EDITABLE MESH<br>-ATTACH LIST）<br>例:烟灰缸，TWO-17，TWO-7，TWO-8，TWO-10<br>三.MORPH(变形)<br>四.SCATTER(离散)<br>五.CONFORM(包裹)<br>六.CONNECT(连接)<br>七.SHAPEMERGE(形体合并)<br>八.BOOLEAN(布尔运算)<br>九.TERRAIN(地形)<br>十.LOFT(放样)（针对于二维图形SHAPES）<br>十一.MESHER(网格化)<br>涡轮平滑(TurboSmooth)</p>
<p>第七讲 创建二维图形（SHAPES）<br>一.二维图形<br>1.LINE（线）<br>1)直线<br>2）曲线<br>（1）点的类型（CORNER角点<br>SMOOTH圆滑<br>BAZIER贝赛尔<br>BAZIER CORNER贝赛尔角点）<br>3)画一条笔直的线(SHIFT+LINE画)<br>4)线的连接(用2D捕捉命令)<br>2.RECTANGLE（矩形）<br>3.CIRCLE（圆）<br>二.二维渲染<br>RENDERING-RENDERABLE（可渲染的）THICHNESS（线变粗变细）<br>渲染圆滑如何提高<br>INTERPOLATION（插补值）<br>STEPS（插入多少个点）-点越多越圆滑<br>OPTIMIZE（优化圆滑）<br>ADAPTIVE（适配圆滑，自动生成圆滑，不需要你填插入多少个点）<br>三.二维变成面(extrude)例如:楼梯,圆形台阶(BEND)<br>四.ARC（弧）<br>1.PIE SLICE(将圆心与弧的两端点连接)<br>2.REVERSE(端点对调)<br>五.DONUT（双圆）(双形在一起为复合形)<br>1.双形在一起为复合形,单形为一形<br>2.START NEW SHAPE(开始新形)<br>六.STAR（星形）<br>七.NGON（多边形）<br>八.ELLIPSE（椭圆）<br>九.TEXT(文本)<br>(多行文字,按回车键)<br>十.HELIX（螺旋线）<br>(motion-trajectories使球沿着螺旋线运动)<br>十一.SECTION(剖面)<br>截取一个三维物体的剖面<br>挤出(Extrude)<br>Amount:挤出多少</p>
<p>第八讲 二维编辑命令（EDIT SPLINE(样条曲线) </p>
<h2 id="二维样条线"><a href="#二维样条线" class="headerlink" title="二维样条线"></a>二维样条线</h2><p>Renderer(渲染)<br>在渲染中启用(Enable In Renderer)<br>在视口中启用(Enable In Viewport)<br>使用视口设置(User Viewport Settings)<br>生成贴图坐标(Generte Mapping Coords)<br>真实世界贴图大小(Real-World Map Size)<br>视口(Viewport) 渲染(Renderer)<br>径向(Radial)<br>厚度(Thickness)</p>
<p>EDIT SPLINE(编辑样条曲线)<br>注：EDIT SPLINE是斜体—针对了多个物体<br>EDIT SPLINE是正体—针对单个物体<br>EDIT SPLINE包括<br>VERTEX(点)<br>SEGMENT(线段)<br>SPLINE(曲线)<br>三个次对象<br>(一)点,线段,曲线所共有的命令<br>1.CREATE LINE（创建线）<br>2.ATTACH(合并)没有对话框合并<br>使二个或多个独立的二维图形变成复合形）<br>3.ATTACH MULT(合并)有对话框合并<br>使二个或多个独立的二维图形变成复合形）<br>4.INSERT（插入）<br>(二)VERTEX(点)<br>1.点的不同类型<br>（CORNER，SMOOTH，BAZIER，BAZIER CORNER）<br>LOCK HANDLES（锁定控制柄）<br>ALIKE （选定相似的手柄，才移动）<br>ALL （所有选定了的手柄都移动）<br>例：雨伞（SQUEEZE(挤压)(1.5,-2,50,1)）<br>2.点的编辑命令<br>1）REFINE（细化，增加点）不改变原线的位置<br>2）INSERT（插入点）会改变原线的位置<br>3）BREAK（断开点）<br>4）CONNECT（将断开的点连接起来）<br>5）WELD(焊接)<br>先选定点,再点击WELD(不考虑点是否断开)<br>6）CROSSINSERT(在交叉处插入点)<br>(注意:CROSSINSERT只针对复合形)<br>7）FILLET（倒圆角）<br>8）CHAMFER（倒直角）<br>9）HIDE (隐藏)<br>10）UNHIDE ALL（取消隐藏）<br>11）DELETE （删除）<br>12）MAKE FIRST（使某一个做为起点）<br>（1）是一个封闭型的二维图形，<br>任何一个都可做为起点<br>（2）如果不是一个封闭型的二维图形<br>只有断开的两个端点才可以做为起点<br>(三)SEGMENT(线段)<br>1.REFINE<br>2.BREAK<br>3.DIVIDE(匀分)（先选定线段，后填数学，点DIVIDE）<br>4.DETACH(分离)<br>1）SAME SHAPES(同一图形)使分离出来的部分仍是源对象的一部分<br>2）REORIENT(重定向)使分离出来的部分独立<br>3）COPY(复制)创建分离次对象的一个新的复制品<br>5.线段 焊接（针对复合形）<br>（选定一段，移动回来，如有多段要移动多次）<br>6.HIDE<br>7.UNHIDE<br>8.DELETE<br>(四)SPLINE(曲线)<br>1.BOOLEAN(只针对复合形)<br>（如果不是复合形，请用ATTACH或<br>ATTACH MULT做成复合形）<br>2.OUTLINE<br>例:茶杯（LATHE）<br>3.TRIM （修剪）（一般最好针对复合形<br>4.MIRROR<br>5.EXTEND<br>6.HIDE<br>7.UNHIDE<br>8.DELETE<br>9.SPLINE 焊接（针对复合形）<br>（选定一段，移动回来，如有多段只要移动一次）</p>
<p>第九讲 LOFT(放样)<br>一.基本概念<br>一个截面(SHAPE)沿着一条路径(PATH)不断的复制<br>注意:1.路径(PATH)只能是一条<br>（可以是LINE，CIRCLE或者其它的二维图形）<br>2.截面(SHAPE)可是一个,也可以是多个<br>(但是多个截面都要是同一类型的（单形，复合形）) 3.路径(PATH)和截面(SHAPE)只能是二维图形<br>例:镜框,吧台,沙发<br>二.LOFT的参数<br>1.SURFACE PARAMETERS(表面参数)<br>(主要针对LENGTH,WIDTH是否光滑)<br><em>*</em> 2.PATH PARAMETERS (路径参数)<br>(主要针对在路径什么地方放什么形)<br>3.SKIN PARAMETERS (表皮参数)<br>(主要针对加盖,增减分格数,是否显示表皮)<br>4.DEFORMATIONS (变形)<br>(SCALE,TWIST,TEETER,BEVEL,FIT)<br>三.LOFT的修改<br>1.PATH（可以使路径变长或变短）<br>2.SHAPE（可以改变形的位置，旋转，缩放）<br>例:盆,窗帘<br>3.SHAPE对齐COMPARE<br>(1)MODIFIERS-SHAPE-COMPARE-PICK SHAPE<br>(2)进入次对象:SPLINE进行旋转<br>例:上面是一个圆,下面是一个矩形的放样<br>放样如果图形放反了怎么办<br>1.如果路径是不封闭的<br>我们用MAKE FIRST改变路径起点的位置<br>点是断开的两个端点<br>2.如果路径是封闭的<br>我们是改变SHAPE(形状)的位置用ROTATE命令<br>第十讲 LOFT(放样)的修改<br>一.DEFORAMTIONS(变形)<br>1.SCALE(缩放)<br>1）截面形放大,缩小<br>2）界面介绍<br>例:FOUR-8,FOUR-9,蹋陷的易拉罐,FOUR-16,SEVEN-2<br>2.TWIST(扭曲)<br>1）截面扭曲<br>例:FOUR-11<br>3.TEETER(倾斜)<br>2）界面介绍<br>例:圆珠笔<br>4.BEVEL(倒角)<br>1）截面倒角<br>2）界面介绍<br>3）优点:圆滑<br>4）缺点:值不能大<br>5）修改器中的BEVEL<br>(1)优点:能很大<br>(2)缺点:不圆滑<br>5.FIT(拟合,适配)<br>1）界面介绍<br>2）物体的厚度感,深度感,高度感用Y轴（LEFT的截面）<br>3）物体的宽度用X轴 （TOP的截面）<br>例:FOUR-18,FOUR-17, FOUR-19,FOUR-20<br>二.模型精度不能太高(因为会影响渲染时间)</p>
<p>第十一讲 CAMERA（照相机）<br>一.改变物体大小1.CAMERA离物体远,物体小,离物体近,物体大2.PARAMETERS(参数)1)LENS(焦距)单位：MM（毫米）(1)焦距值大——离物体近——物体大—-物体越清晰相应的视野也就越小 ——看到的物体也就越少(2)焦距值小——离物体远——物体小—-物体也不很清晰相应的视野也就越大 ——看到的物体也就越多2)FOV(视野)（FIELD OF VIEW）单位：DEGREE（度）(1)视野大——离物体远——物体小 ——看到的物体也就越多(2)视野小——离物体近——物体大——看到的物体也就越少3）LENS(焦距)与FOV(视野)之间是相反的。二.SHOW CONE（显示锥形）（无论是否选定照相机，照相机的视野都会显示）三.SHOW HORIZON(显示水平线)照相机的水平线四.ENVIRONMENT RANGES(环境范围)要以环境挂上钩1.RENDERING—ENVIRONMENT—ATMOSPHERE(大气)—FOG(雾)1)ACTIVE(激活雾)2) MERGE(合并另外一个场景的特效,如没特效,只是合并场景)3)TYPE(类型)STANDARD(标准雾)(均匀分布,沿水平方向分布)LAYERED(层雾)(沿垂直方向分布)2.NEAR RANGE(近距离范围)(弱,密度没有)3.FAR RANGE(远距离范围)(强,密度最大)4.NEAR RANGE到FAR RANGE之间的雾越来越多五.CLIPPING PLANES(剪切平面)1.CLIPPING MANUALLY(从NEAR到FAR两者间的物体显示,不在两者间的物体不显示)第十二讲 MATERIAL EDITOR（材质编辑器） 一.概念1.材质:是指物体外表信息的表现(包括:颜色,高光,光泽度,透明度等等)2.贴图:是指带有图案,纹理的图像信息,它附于材质之上注意:物体一定有材质,可以没有贴图3.热材质（同步材质）:赋给了物体的材质球(边有白框)4.冷材质（不同步材质）:没有赋给物体的材质球二.SHADER(阴影) BASIC（基础） PARAMETERS1.渲染模式2.WIRE（网格）1)网格与物体的分格数（SEGMENTS）有关2)用一步修改网格(1)加粗(EXTENDED PARAMETERS-WIRE-PIXELS(远近一样粗细)UNITS(远细,近粗 )3）二维物体网格—没有分格数插入EDIT SPLINE-SEGMENT-DEVIDE（注：顶盖，顶底没有）3.2-SIDED（内外所赋的材质是一样）4.FACE MAP5.FACETED三.不同渲染模式的基本参数( XXXXXX BASIC PARAMETERS)1.AMBIENT(背光区)2.DIFFUSE(主光区)3.SPECULAR(高光区,高光在什么地方与灯有必然的联系)1)SPECULAR LEVEL (高光级别)2)GLOSSINESS (光泽度,控制高光的面积)3)SOFTEN (柔和0~1,高光与非高光之间的过渡)4.SELF-ILLUMINATION (自发光,可以用数字表示,也可以用颜色表示)5.OPACITY (不透明度)1)值越低,越透明,物体越不亮2)可以进一步对透明进行修改EXTENDED PARAMETERS-ADVANCED TRANSPARENCYFALL OFF(衰减) TYPE(1)FILTER(过滤,在物体上留下一种颜色)(2)SUBTRACTIVE(当前物体颜色减去背景色)使物体更暗(3)ADDITIVE(当前物体颜色加上背景色)使物体更亮例:杯子,矿泉水瓶注意:玻璃作透明不能太厚3)INDEX OF REFRACTION(折射率)水(1.3)玻璃(1.5)高光固体(2.0)四.改变背景色的颜色(RENDERING-ENVIRONMENT)第十三讲 材质(二) 一.渲染模式<em>1.METAL(金属)1)SPECULAR(高光度) 最佳的取值范围（60~70）2)GLOSSINESS(光泽度) 最佳的取值范围（60~70）2.ANISOTROPIC(各向异形)主要控制高光的形状1)ANISOTROPIC(0,圆形高光,50,椭圆高光,100,线形高光)2)ORIENTATION(控制高光的方向)3.MULTI-LAYER(多层)在ANISOTROPIC基础上再增加一层来控制高光4.STRAUSS(金属加强)(金属渲染方式一种)渲染粗糙,不光滑,有凹凸感<br>**5.BLINN(反射)柔和一点,低光照射的效果6.PHONG(多面)与BLINN相似7.OREN-NAYER-BLINN(明暗处理器)适合于制作表现物体模糊的”材质”二.图标介绍1.GET MATERIAL(获取材质)(注:只能获取材质,不能获取贴图)1)MTLIBARY (从材质库中获取材质)(C:\3DMAX4.0\MATLIBS\</em>.MAT)2)MTL EDITOR (从材质编辑器中获取材质)(一共有24个)3)ACTIVE (从激活的样本球(白框)中获取材质)4)SELECTED (从选定的物体中获取材质)5)SCENCE (从场景中获取材质)6)NEW (获取新的材质)2.PUT MATERIAL TO SCENE (将修改了的材质,重新赋给场景)3.ASSIGN MATERIAL TO SELECTION (将指定的材质赋给选定的对象)4.RESET MAP/MTL TO DEFAULT SETTINGS (恢复到默认的设置)5.MAKE MATERIAL COPY (将热材质进行复制)(注:1)当是热材质时,才有用 2)热材质变成冷材质,没有热材质标志)6.PUT TO LIBRARY(将编辑好的材质保存到材质库中,从材质库中可获取此材质)第十四讲 材质（三） 一.贴图（是指带有图案,纹理的图像信息,它附于材质之上）1.如何贴图1)通过选择MAPS(贴图)中的通道来贴图例:DIFFUSE COLOR(主光区颜色通道)2.图的来源方式1)自带的程序图(例如:BRICK,CELLULAR等等)**<br>2)拾取外面的图(通过BITMAP)（注意：当你拾取外面的图时，注意图片格式图片格式是PSD的话是能拾取的）3.图的修改1)COORDINATES(贴图极坐标)(偏移,平铺,旋转)2)BITMAP PARAMETERS(位图参数)（只有拾取外面的图才有）4.有些图贴不上去,是因为贴图坐标的问题1)创建一个物体都带有GENERATE MAPPING COORDS(贴图坐标)(1)BOX5.贴图坐标的修改器MODIFIERS—UV COORDINATE—UVW MAP（针对于解决MISSING MAP COORDINATES（丢失贴图坐标）的问题）1)PLANAR (平面)2)CYLINDRICAL(圆柱体)3)SPHERICAL (球体) 4)SHRINK WRAP(收缩包裹) 5)BOX (盒子)6)FACE (面状)（与分格数有关）7)XYZ TO UVW (物体本身具有的坐标 到 图贴的方向)</p>
<ol>
<li>对齐 <strong>1)FIT （适配） 2)CENTER （使图居中）3)BITMAP FIT （根据你所选的位图对齐）4)NORMAL ALIGN（法线对齐，只能在透视图中进行可任意移动图片在任意面上</strong>5)VIEW ALIGN （以当前正交视图对齐）**<br>6)REGION FIT （画一个区域进行贴，会产生重复贴， 想不重复贴回到材质编辑器，取消TILE钩）7)RESET （恢复原始值）8)ACQUIRE （从其它物体获取一个贴图坐标）（相对，绝对）（1-W的值）/2=U的值（图水平放在中间）（1-H的值）/2=V的值（图垂直放在中间）.jpg .bmp .tif .tga .png .psd（在3DMAX5.0中支持）</li>
</ol>
<p>g键关闭网格，右键对象菜单，选择对象属性，勾选以灰色显示冻结。<br>摁住Shift可以画出直线。</p>
<h1 id="Bones和Biped的区别"><a href="#Bones和Biped的区别" class="headerlink" title="Bones和Biped的区别"></a>Bones和Biped的区别</h1><p>用bones需要自己创建骨骼系统（比如人、动物、怪物等的骨骼），会使用到很多的约束、参数关键等；如果只是简单的机械臂，或者简单的几根骨骼动画，用这个还是比较方便的。而biped是系统自带的适合于两足动物的骨骼系统（当然也可以调节适合马、虎等动物），各种骨骼约束关联创建好了，直接可以蒙皮使用。</p>
<p>蒙皮： <a href="http://yuntv.letv.com/bcloud.html?uu=ejtjj0ntox&amp;vu=4b9dd28064&amp;pu=75346142bf&amp;auto_play=0&amp;gpcflag=1&amp;width=100%&amp;height=100%&amp;isPlayerAd=0" target="_blank" rel="noopener">http://yuntv.letv.com/bcloud.html?uu=ejtjj0ntox&amp;vu=4b9dd28064&amp;pu=75346142bf&amp;auto_play=0&amp;gpcflag=1&amp;width=100%&amp;height=100%&amp;isPlayerAd=0</a><br>先确定旋转方向，然后在确定高度。<br>视图操作栏，命令面板，创建面板，<br>四大键：Q,W,E,R<br>Q选择工具，点选，点击视图中的物体。按住鼠标左键不放，框选。<br>减选：Alt键，<br>加选：Ctrl键，点击物体或者框选物体。<br>Alt+A全选<br>Q：改变框选方式。<br>窗口和交叉：如果交叉，表示必须将物体完全的框住。<br>W:是一个双重工具。选择并且移动。X键可以放大或者缩小。<br>E：旋转功能<br>R：缩放功能，放在中心区域，三个轴同时缩放。<br>Zomm Extends All Selected<br>Orbit Subobject:旋转视图。</p>
<h1 id="烘培法线"><a href="#烘培法线" class="headerlink" title="烘培法线"></a>烘培法线</h1><p>首先创建一个正方体<br><img src="/2019/05/11/3dmax/1.jpg"><br>复制一个出来，改成其他颜色，接下来白色模型卡线，加涡轮平滑或者网格平滑命令。<br><img src="/2019/05/11/3dmax/2.jpg"><br>选中线少的正方体，打开UVW展开编辑器<br><img src="/2019/05/11/3dmax/3.jpg"><br>接下来开始烘培法线，先选中底模，先按大键盘的0键打开烘培面板，然后选取高模。<br><img src="/2019/05/11/3dmax/4.jpg"><br>重置一下，然后数量给2或者3<br><img src="/2019/05/11/3dmax/5.jpg"><br><img src="/2019/05/11/3dmax/6.jpg"><br><img src="/2019/05/11/3dmax/7.jpg"><br><img src="/2019/05/11/3dmax/8.jpg"><br><img src="/2019/05/11/3dmax/9.jpg"><br><img src="/2019/05/11/3dmax/10.jpg"><br>然后点击渲染，这里法线贴图得到所在文件夹去查找。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/11/vspathmacro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/11/vspathmacro/" class="post-title-link" itemprop="url">vspathmacro</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-11 09:45:29" itemprop="dateCreated datePublished" datetime="2019-05-11T09:45:29+08:00">2019-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VS/" itemprop="url" rel="index"><span itemprop="name">VS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>$(SolutionDir)</td>
<td>解决方案的目录（定义形式：驱动器+路径）；包括尾部的反斜杠”\”，和sln同级目录</td>
</tr>
</tbody>
</table>
</div>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/10/marshal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/marshal/" class="post-title-link" itemprop="url">marshal</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-10 21:11:03" itemprop="dateCreated datePublished" datetime="2019-05-10T21:11:03+08:00">2019-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/10/csharpstructbytealignment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/csharpstructbytealignment/" class="post-title-link" itemprop="url">C#结构体字节对齐方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-10 19:57:56" itemprop="dateCreated datePublished" datetime="2019-05-10T19:57:56+08:00">2019-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSharp/" itemprop="url" rel="index"><span itemprop="name">CSharp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">StructLayout(LayoutKind.Sequential, CharSet=CharSet.Ansi)</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">struct</span> DllInvoices</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">MarshalAs(UnmanagedType.ByValArray, SizeConst=8)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] serial;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span> Type;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">uint</span> Sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用Marshal.SizeOf(typeof(DllInvoices))得到的大小为16，为什么不是13？<br>这其实是体系结构和汇编的问题。<br>在内存里特定类型数据的起始地址通常有一定的对齐要求，比如说32位机器上的int起始地址必须是4的整数倍，结构通常也是如此。<br>如果一个结构包含一个char和一个int，那么char作为结构体的第一个字段，需要在4的整数倍地址开始，而int有同样的要求，所以char之后必须空出3个字节来，才能使int的地址满足对齐的要求。<br>.NET的CLR是基于32位的，所以也是4字节对齐的。在byte之后，必须空出3个字节。所以结果就是16字节了。<br>可以通过StructLayout的Pack属性改变这种对齐设置。</p>
<pre><code>[StructLayout(LayoutKind.Sequential, CharSet=CharSet.Ansi, Pack=1)]
</code></pre><p>MarshalAs属性指示如何在托管代码和非托管代码之间封送数据。</p>
<p>当MarshalAsAttribute.Value设置为ByValArray时，必须设置SizeConst以指示数组中的元素数。当需要区分字符串类型时，ArraySubType字段可以选择包含数组元素的UnmanagedType。此UnmanagedType只可用于作为结构中的字段的数组。<br>而SizeConst则是指数组的元素个数。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/10/quaternion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/quaternion/" class="post-title-link" itemprop="url">quaternion</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-10 17:55:36" itemprop="dateCreated datePublished" datetime="2019-05-10T17:55:36+08:00">2019-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="三维空间中的旋转"><a href="#三维空间中的旋转" class="headerlink" title="三维空间中的旋转"></a>三维空间中的旋转</h1><p>在讨论四元数之前，我们先来研究一下三维空间中旋转。<br>表示三维空间中旋转的方法有很多种，但我们这里关注的是轴角式（Axis-angle）的旋转。虽然使用欧拉角的旋转很常用，但是我们知道欧拉角的表示方法不仅会导致Gimbal Lock而且依赖于三个坐标轴的选定，使用四元数正是为了解决这个问题。我们这里所要讨论的轴角式旋转是旋转更加普遍的情况：<br>假设我们有一个经过原点的（如果旋转轴不经过原点我们可以先将旋转轴平移到原点，进行旋转，在平移回原处）旋转轴$u=(x,y,z)^T$，我们希望将一个向量v，沿着这个旋转轴旋转$\theta$度，变换到v’：</p>
<img src="/2019/05/10/quaternion/1.png">
<p>注意，在这篇教程中我们将使用右手坐标系统，并且我们将使用右手定则来定义旋转的正方向。</p>
<h1 id="四元素"><a href="#四元素" class="headerlink" title="四元素"></a>四元素</h1><p>终于，我们可以开始讨论四元数与旋转之间的关系了。四元数的定义和复数非常类似，唯一的区别就是四元数一共有三个虚部，而复数只有一个。所有的四元数都可以协程下面这种形式：<br>$q=a+bi+cj+dk (a,b,c,d \in R)$<br>其中：<br>$i^2=j^2=k^2=ijk=-1$</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/10/jobsystemnativecontainer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/jobsystemnativecontainer/" class="post-title-link" itemprop="url">jobsystemnativecontainer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-10 14:14:20" itemprop="dateCreated datePublished" datetime="2019-05-10T14:14:20+08:00">2019-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>Allocator.Temp has the fastest allocation.It is for allocations with a lefespan(寿命) of one frame or fewer.</li>
<li>Allocator.TempJob is a slower allocation than Temp but is faster than Persistent.It is for allocations within a lifespan of four frames and is thread-safe. </li>
<li>Allocator.Persistent is the slowest allocation but can last as long as you need it to,</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/10/EventSource/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/EventSource/" class="post-title-link" itemprop="url">EventSource</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-10 14:03:59" itemprop="dateCreated datePublished" datetime="2019-05-10T14:03:59+08:00">2019-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:37" itemprop="dateModified" datetime="2021-06-17T10:39:37+08:00">2021-06-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GameFramework/" itemprop="url" rel="index"><span itemprop="name">GameFramework</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>原则上不会出现托管堆数据，不会List接口，数据统一申请，按需释放。</li>
<li>充分利用CPU，防止让线程之间切换时间片的发生。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/10/csharp-thread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/csharp-thread/" class="post-title-link" itemprop="url">CSharp Thread</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-10 11:22:20" itemprop="dateCreated datePublished" datetime="2019-05-10T11:22:20+08:00">2019-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSharp/" itemprop="url" rel="index"><span itemprop="name">CSharp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="IsBackground"><a href="#IsBackground" class="headerlink" title="IsBackground"></a>IsBackground</h1><p>A thread is either a background thread or a foreground thread.Background threads are identical to foreground threads,except that background threads do not prevent a process from terminating.<br>通过Thread类新建线程默认为前台线程。当所有前台线程关闭时，所有的后台线程也会被直接终止，不会抛出异常。</p>
<h1 id="Thread-sleep-0"><a href="#Thread-sleep-0" class="headerlink" title="Thread.sleep(0)"></a>Thread.sleep(0)</h1><p>在Java或者C#中，都会用到Thread.Sleep()来使线程挂起一段时间。<br>那么你有没有正确的理解这个方法的用法呢？思考下面这两个问题：</p>
<ol>
<li>假设现在2019-5-13 17:00:00.000，如果我调用一下Thread.Sleep(1000)，在2019-5-13 17:00:01.000的时候，这个线程会不会被唤醒？</li>
<li>代码中添加：Thread.Sleep(0)。既然是Sleep 0毫秒，那么和去掉这句代码相比，有什么区别？</li>
</ol>
<p>首先回顾一下操作系统原理<br>在操作系统中，CPU竞争有很多种策略。Unix系统使用的是时间片算法，而Windows则属于抢占式的。<br>在时间片算法中，所有的进程拍成一个队列。操作系统按照他们顺序，给每个进程分配一段时间，即该进程允许运行的时间。<br>如果在时间片结束时进程还在运行，则CPU将被剥夺并分配给另一个进程。如果进程在时间片结束前阻塞或结束，则CPU当即进行切换。调度程序所要做的就是维护一张就绪进程列表，当进程用完它的时间片后，它被移到队列的末尾。<br>所谓抢占式操作系统，就是说如果一个进程得到了CPU时间，除非它自己放弃使用CPU，否则将完全霸占CPU。因此可以看出，在抢占式操作系统中，操作系统假设所有的进程都会主动退出CPU。<br>在抢占式操作系统中，假设有若干进程，操作系统会根据他们的优先级、饥饿时间（已经多长时间没有使用过CPU了），给他们算出一个总的优先级来。操作系统就会把CPU交给总优先级最高的这个进程。<br>当进程执行完毕或者自己主动挂起后，操作系统就会重新计算一次所有进程的总优先级，然后在挑一个优先级最高的把CPU控制权交给他。<br>我们用分蛋糕的场景来描述这两种算法。假设有源源不断的蛋糕（源源不断的时间），一副刀叉（一个CPU），10个等待吃蛋糕的人（10个进程）。<br>如果是Unix操作系统来负责分蛋糕，那么他会这样顶规定：每个人上来吃1分钟，时间到了换下一个。最后一个人吃完了就再从头开始。于是，不管这10个人是不是优先级不同、饥饿成都不同、饭量不同，每个人上来的时候都可以吃1分钟。当然，如果有人本来不太饿，或者饭量小，吃了30秒中之后就吃饱了，那么也可以跟操作系统说：我已经吃饱了（挂起）。于是操作系统就会让下一个人接着吃。<br>如果是Windows操作系统来负责分蛋糕的，那么场面就很有意思了。<br>他会这样顶规矩：我会根据你们的优先级、饥饿程序会给你们每个人计算一个优先级。<br>优先级最高的那个人，可以上来吃蛋糕，吃到你不想吃为止。等这个人吃完了，我再重新根据优先级、饥饿程序来计算每个人的优先级，然后再分给优先级最高的那个人。<br>这样看来，这个场面就很意思了，可能有些人是MM，因此具有高优先级，于是她就可以经常来吃蛋糕。可能另外一个人优先级特别低，于是好半天了才轮到他一次（因为随着时间的推移，他会越来越饥饿，因此算出来的总优先级就会越来越高，因此总有一天会轮到他）。而且，如果一不小心让一个大胖子得到了刀叉，因为他饭量大，可能他会霸占着蛋糕连续吃很久很久。<br>而且，还可能会有这种情况出现：操作系统现在计算出来的结果，5号MM总优先级最高，而且高出别人一大截。因此就叫5号来吃蛋糕。5号吃了一小会儿，觉得没那么饿了，于是说“我不吃了”（挂机）。因此操作系统就会重新计算所有人的优先级。因为5号刚刚吃过，因此她的饥饿程序变小了，于是总优先级变小了；而其他人因为多等了一会儿，饥饿程度都变大了，所以总优先级也变大了。<br>不过这时候仍然有可能5号的优先级比别的都搞，只不过现在只比其他的高一点点，但她仍然是总优先级最高的呀。因此操作系统就会说：5号MM上来吃蛋糕….（5号MM心里郁闷，这不刚吃过嘛，人家要减肥。。谁叫你长那么漂亮，获得了那么高的优先级）。<br>那么，Thread.Sleep()是干吗的呢？还用刚才的分蛋糕的场景来描述。<br>上面的场景里面，5号MM再吃了一次蛋糕之后，觉得已经有8分饱了，她觉得再未来半个小时之内不想再来吃蛋糕了，那么她就会跟操作系统说：再未来的半小时之内不要叫我上来吃蛋糕了。这样，操作系统再随后的半小时里面重新计算所有人总优先级的时候，就会忽略5号MM。Sleep函数就是干这事的，他告诉操作系统“在未来的多少毫秒内我不参与CPU竞争”。<br>看完了Thread.Sleep()的作用，再来考虑前面的两个问题。<br>对于第一个问题，答案是：不一定，因为你只是告诉操作系统：在未来的1000毫秒内我不想再参与到PU竞争。那么1000毫秒过去之后，这时候也许另外一个线程正在使用CPU。<br>那么这时候操作系统是不会重新分配CPU的，直到那个线程挂起或结束；<br>况且，即使这个时候恰巧轮到操作系统进行CPU分配，那么当前线程也不一定就是总优先级最高的那个，CPU还是可能被其他线程抢占去。<br>与此相似的，Thread有个Resume()，用来唤醒挂起的线程。当然，这个函数只是“告诉操作系统我从现在开始参与CPU竞争了”，这个函数的调用并不能马上使得这个线程获得CPU的控制权。<br>不过，因为具有死锁倾向，JDK1.6以后已经不赞成是使用Thread.stop、Thread.suspend、Thread.resume。<br>对于第二个问题，答案是：有，而且区别很明显，假如我们刚才的分蛋糕场景里面，有另外一个MM7号，而且饭量也很大。<br>不过7号人品很好，她很善良，她没吃几口就会想：如果现在有别人比我更需要吃蛋糕，那么我就让他。因此，她可以每吃几口就跟操作系统说：我们来重新计算一下所有人的总优先级吧。<br>不过，操作系统不接受这个建议，因为操作系统不提供这个接口。于是7号就换了个说法：“再未来0毫秒之内不要再叫我上来吃蛋糕了”。<br>这个指令时操作系统接受的，于是此时操作系统就会重新计算大家的总优先级，注意这个时候是连7号一起计算的，因为“0毫秒已经过去了”嘛。因此如果没有比7号更需要吃蛋糕的人出现，那么下一次7号还是会被叫上来吃蛋糕。<br>因此，Thread.Sleep(0)的作用，就是“触发操作系统立刻重新进行一次CPU竞争”。<br>竞争的结果也许是当前线程仍然获得CPU控制权，也许会换成别的线程获得CPU控制权。<br>这也是我们再大循环里面经常会写一句Thread.Sleep(0)，因为这样就给了其他线程比如Paint线程获得CPU控制的权力，这样界面就会不会假死再那里。<br>另外，虽然上面提到说“除非它自己放弃使用CPU，否则将完全霸占CPU”<br>但这个行为仍然是收到制约的，操作系统会监控你霸占CPU的情况，如果发现某个线程长时间霸占CPU，会强制使用这个线程挂起。<br>因此实际上不会出现“一个线程一直霸占着CPU不放”的情况。其实再Windwos原理层面，CPU竞争都是线程级的，本文中把这里的线程、进程看成一个东西就可以了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2019/05/10/loadfromfileasyncandyield/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/loadfromfileasyncandyield/" class="post-title-link" itemprop="url">LoadFromFileAsync和Yield的问题探究</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-10 09:11:21" itemprop="dateCreated datePublished" datetime="2019-05-10T09:11:21+08:00">2019-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="问题提出"><a href="#问题提出" class="headerlink" title="问题提出"></a>问题提出</h1><p>昨晚临下班的时候在同时讨论到Unity的资源异步加载接口是否是多线程的时候，然后自己发了一份源自网上的测试文档，地址：<a href="https://github.com/zentia/UnityDemo" target="_blank" rel="noopener">https://github.com/zentia/UnityDemo</a><br>然后群里开始讨论这个问题，根据文档出现两个分歧</p>
<ol>
<li>LoadFormFileAsync是否是多线程实现的？</li>
<li>yield 即协程是否是多线程实现的？</li>
</ol>
<p>带着上述两个问题，我们开始分析和验证。</p>
<h1 id="验证与分析"><a href="#验证与分析" class="headerlink" title="验证与分析"></a>验证与分析</h1><h2 id="LoadFormFileAsync是否是多线程？"><a href="#LoadFormFileAsync是否是多线程？" class="headerlink" title="LoadFormFileAsync是否是多线程？"></a>LoadFormFileAsync是否是多线程？</h2><p>测试环境：Unity 2018.3<br>测试平台：Windows(由于没有Android打包环境和设备，暂时选Windows)<br>测试工程：<a href="https://github.com/zentia/UnityDemo" target="_blank" rel="noopener">https://github.com/zentia/UnityDemo</a><br><img src="/2019/05/10/loadfromfileasyncandyield/1.png"><br><img src="/2019/05/10/loadfromfileasyncandyield/2.png"><br><img src="/2019/05/10/loadfromfileasyncandyield/6.png"><br>好吧，是图片不具有代表性吗？那我们换大点的图片。<br><img src="/2019/05/10/loadfromfileasyncandyield/3.png"> <img src="/2019/05/10/loadfromfileasyncandyield/4.png"> <img src="/2019/05/10/loadfromfileasyncandyield/5.png"><br>从结果来看，我认为LoadFromFileAsync内部是多线程实现的。协程不具备多线程的功能。<br>我们来分析协程，下面是4.7的源码</p>
<h2 id="Coroutine"><a href="#Coroutine" class="headerlink" title="Coroutine"></a>Coroutine</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"UnityPrefix.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coroutine.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> ENABLE_SCRIPTING</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Misc/AsyncOperation.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Mono/MonoBehaviour.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Mono/MonoScript.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Mono/MonoIncludes.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Mono/MonoManager.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/GameCode/CallDelayed.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Export/WWW.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Scripting/ScriptingUtility.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Scripting/Backend/ScriptingBackendApi.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Scripting/ScriptingObjectWithIntPtrField.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_IPHONE_API</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Input/OnScreenKeyboard.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Scripting/Backend/ScriptingBackendApi.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// copied from MonoBehaviour.cpp</span></span><br><span class="line"><span class="comment">// if they should be synced - blame the author not me ;-)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG_COROUTINE 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG_COROUTINE_LEAK 0</span></span><br><span class="line"></span><br><span class="line">Coroutine::Coroutine()</span><br><span class="line">    : m_DoneRunning(<span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> coroutineCounter = <span class="number">0</span>;</span><br><span class="line">    coroutineCounter++;</span><br><span class="line">    printf_console(<span class="string">"Allocating coroutine %d --- %d : 0x%x\n"</span>, <span class="keyword">this</span>, coroutineCounter, &amp;m_RefCount);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Coroutine::~Coroutine()</span><br><span class="line">&#123;</span><br><span class="line">    Assert(m_CoroutineEnumeratorGCHandle == <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE</span></span><br><span class="line">    printf_console(<span class="string">"Deconstructor coroutine %d\n"</span>, <span class="keyword">this</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Coroutine::SetMoveNextMethod(ScriptingMethodPtr method)</span><br><span class="line">&#123;</span><br><span class="line">    m_MoveNext = method;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Coroutine::SetCurrentMethod(ScriptingMethodPtr method)</span><br><span class="line">&#123;</span><br><span class="line">    m_Current = method;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Coroutine::ContinueCoroutine (Object* o, <span class="keyword">void</span>* userData)</span><br><span class="line">&#123;</span><br><span class="line">    Coroutine* coroutine = (Coroutine*)userData;</span><br><span class="line">    Assert(coroutine-&gt;m_RefCount &gt; <span class="number">0</span> &amp;&amp; coroutine-&gt;m_RefCount &lt; <span class="number">1000000</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ((Object*)coroutine-&gt;m_Behaviour != o)</span><br><span class="line">    &#123;</span><br><span class="line">        ErrorString(<span class="string">"Coroutine continue failure"</span>);</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE</span></span><br><span class="line">        <span class="keyword">if</span> ((Object*)coroutine-&gt;m_Behaviour != o)</span><br><span class="line">        &#123;</span><br><span class="line">            printf_console (<span class="string">"continue Coroutine fuckup %d refcount: %d behaviour: %d \n"</span>, coroutine, coroutine-&gt;m_RefCount, coroutine-&gt;m_Behaviour);</span><br><span class="line">            printf_console (<span class="string">"continue Coroutine fuckup name: %s methodname\n"</span>, ((MonoBehaviour*)(o))-&gt;GetScript()-&gt;GetName());</span><br><span class="line">            <span class="keyword">if</span> (coroutine-&gt;m_CoroutineMethod)</span><br><span class="line">                printf_console (<span class="string">"continue Coroutine methodname: %s\n"</span>, scripting_method_get_name(coroutine-&gt;m_CoroutineMethod));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    coroutine-&gt;Run ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Coroutine::CleanupCoroutine (<span class="keyword">void</span>* userData)</span><br><span class="line">&#123;</span><br><span class="line">    Coroutine* coroutine = (Coroutine*)userData;</span><br><span class="line">    AssertIf(coroutine-&gt;m_RefCount &lt;= <span class="number">0</span>);</span><br><span class="line">    AssertIf(coroutine-&gt;m_RefCount &gt; <span class="number">1000000</span>);</span><br><span class="line">    coroutine-&gt;m_RefCount--;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE</span></span><br><span class="line">    printf_console(<span class="string">"decrease refcount %d - active: %d \n"</span>, coroutine, coroutine-&gt;m_RefCount);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (coroutine-&gt;m_RefCount &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    coroutine-&gt;m_DoneRunning = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE</span></span><br><span class="line">    printf_console (<span class="string">"CleanupCoroutine %d\n"</span>, coroutine);</span><br><span class="line">    <span class="keyword">if</span> (coroutine-&gt;m_Behaviour &amp;&amp; GetDelayedCallManager().HasDelayedCall(coroutine-&gt;m_Behaviour, Coroutine::ContinueCoroutine, CompareCoroutineMethodName, coroutine))</span><br><span class="line">    &#123;</span><br><span class="line">        printf_console (<span class="string">"FUCKUP is still in delayed call manager%d!\n"</span>, coroutine-&gt;m_Behaviour);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (coroutine-&gt;m_ContinueWhenFinished)</span><br><span class="line">    &#123;</span><br><span class="line">        CleanupCoroutine (coroutine-&gt;m_ContinueWhenFinished);</span><br><span class="line">        coroutine-&gt;m_ContinueWhenFinished = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (coroutine-&gt;m_WaitingFor)</span><br><span class="line">        coroutine-&gt;m_WaitingFor-&gt;m_ContinueWhenFinished = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    coroutine-&gt;RemoveFromList();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (coroutine-&gt;m_AsyncOperation)</span><br><span class="line">    &#123;</span><br><span class="line">        coroutine-&gt;m_AsyncOperation-&gt;SetCoroutineCallback(<span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">        coroutine-&gt;m_AsyncOperation-&gt;Release();</span><br><span class="line">        coroutine-&gt;m_AsyncOperation = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Assert(coroutine-&gt;m_CoroutineEnumeratorGCHandle != <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    scripting_gchandle_free (coroutine-&gt;m_CoroutineEnumeratorGCHandle);</span><br><span class="line"></span><br><span class="line">    coroutine-&gt;m_CoroutineEnumeratorGCHandle = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!coroutine-&gt;m_IsReferencedByMono)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> coroutine;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE_LEAK</span></span><br><span class="line">        gCoroutineCounter--;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Coroutine::CleanupCoroutineGC (<span class="keyword">void</span>* userData)</span><br><span class="line">&#123;</span><br><span class="line">    Coroutine* coroutine = (Coroutine*)userData;</span><br><span class="line">    <span class="keyword">if</span> (!coroutine-&gt;m_IsReferencedByMono)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (coroutine-&gt;m_RefCount != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        coroutine-&gt;m_IsReferencedByMono = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ErrorIf(coroutine-&gt;IsInList());</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">delete</span> coroutine;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE</span></span><br><span class="line">    printf_console (<span class="string">"GC free coroutine: %d\n"</span>, coroutine);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">            </span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE_LEAK</span></span><br><span class="line">    gCoroutineCounter--;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> Coroutine::CompareCoroutineMethodName (<span class="keyword">void</span>* callBackUserData, <span class="keyword">void</span>* cancelUserdata)</span><br><span class="line">&#123;</span><br><span class="line">    Coroutine* coroutine = (Coroutine*)callBackUserData;</span><br><span class="line">    <span class="keyword">if</span> (!coroutine-&gt;m_CoroutineMethod)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">strcmp</span>(scripting_method_get_name(coroutine-&gt;m_CoroutineMethod), (<span class="keyword">const</span> <span class="keyword">char</span>*)cancelUserdata) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> Coroutine::InvokeMoveNext(ScriptingExceptionPtr* exception)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">ScriptingInvocation <span class="title">invocation</span><span class="params">(m_MoveNext)</span></span>;</span><br><span class="line">    invocation.object = m_CoroutineEnumerator;</span><br><span class="line">    invocation.classContextForProfiler = m_Behaviour-&gt;GetClass();</span><br><span class="line">    invocation.objectInstanceIDContextForException = m_Behaviour-&gt;GetInstanceID();</span><br><span class="line">    <span class="keyword">bool</span> result = invocation.Invoke&lt;<span class="keyword">bool</span>&gt;(exception);</span><br><span class="line">    <span class="keyword">return</span> result &amp;&amp; *exception==<span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Coroutine::Run ()</span><br><span class="line">&#123;</span><br><span class="line">    Assert(m_RefCount != <span class="number">0</span>);</span><br><span class="line">    Assert(m_Behaviour != <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE</span></span><br><span class="line">    AssertIf(GetDelayedCallManager().HasDelayedCall(m_Behaviour, Coroutine::ContinueCoroutine, CompareCoroutineMethodName, <span class="keyword">this</span>));</span><br><span class="line">    <span class="keyword">if</span> (m_Behaviour == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        printf_console (<span class="string">"Coroutine fuckup %d refcount: %d behaviour%d\n"</span>, <span class="keyword">this</span>, m_RefCount, m_Behaviour);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// - Call MoveNext (This processes the function until the next yield!)</span></span><br><span class="line">    <span class="comment">// - Call Current (This returns condition when to continue the coroutine next.)</span></span><br><span class="line">    <span class="comment">//   -&gt; Queue it based on the continue condition</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Temporarily increase refcount so the object will not get destroyed during the m_MoveNext call</span></span><br><span class="line">    m_RefCount++;</span><br><span class="line">    ScriptingExceptionPtr exception = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">bool</span> keepLooping = InvokeMoveNext(&amp;exception);</span><br><span class="line">    AssertIf(m_RefCount &lt;= <span class="number">0</span> || m_RefCount &gt; <span class="number">10000000</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">bool</span> coroutineWasDestroyedDuringMoveNext = m_RefCount == <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// Decrease temporary refcount so the object will not get destroyed during the m_MoveNext call</span></span><br><span class="line">    CleanupCoroutine(<span class="keyword">this</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// The coroutine has been destroyed in the mean time, probably due to a call to StopAllCoroutines, stop executing further</span></span><br><span class="line">    <span class="keyword">if</span> (coroutineWasDestroyedDuringMoveNext)</span><br><span class="line">    &#123;</span><br><span class="line">        Assert(m_ContinueWhenFinished == <span class="literal">NULL</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (exception != <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Are we done with this coroutine?</span></span><br><span class="line">    <span class="keyword">if</span> (!keepLooping)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// If there is a coroutine waiting for this one to finish Run it!</span></span><br><span class="line">        <span class="keyword">if</span> (m_ContinueWhenFinished)</span><br><span class="line">        &#123;</span><br><span class="line">            AssertIf (<span class="keyword">this</span> != m_ContinueWhenFinished-&gt;m_WaitingFor);</span><br><span class="line">            Coroutine* continueWhenFinished = m_ContinueWhenFinished;</span><br><span class="line">            m_ContinueWhenFinished-&gt;m_WaitingFor = <span class="literal">NULL</span>;</span><br><span class="line">            m_ContinueWhenFinished = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="comment">// The coroutine might have been stopped inside of the last coroutine invokation</span></span><br><span class="line">            <span class="keyword">if</span> (continueWhenFinished-&gt;m_Behaviour)</span><br><span class="line">                continueWhenFinished-&gt;Run ();</span><br><span class="line">            CleanupCoroutine (continueWhenFinished);</span><br><span class="line">        &#125;</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> (m_Behaviour == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    ProcessCoroutineCurrent();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Coroutine::ProcessCoroutineCurrent()</span><br><span class="line">&#123;</span><br><span class="line">    ScriptingExceptionPtr exception = <span class="literal">NULL</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !UNITY_FLASH</span></span><br><span class="line">    <span class="function">ScriptingInvocation <span class="title">invocation</span><span class="params">(m_Current)</span></span>;</span><br><span class="line">    invocation.object = m_CoroutineEnumerator;</span><br><span class="line">    invocation.objectInstanceIDContextForException = m_Behaviour-&gt;GetInstanceID();</span><br><span class="line">    invocation.classContextForProfiler = m_Behaviour-&gt;GetClass();</span><br><span class="line">    ScriptingObjectPtr monoWait = invocation.Invoke(&amp;exception);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    ScriptingObjectPtr monoWait = Ext_Flash_getProperty(m_CoroutineEnumerator,<span class="string">"IEnumerator_Current"</span>); </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    AssertIf(m_RefCount &lt;= <span class="number">0</span> || m_RefCount &gt; <span class="number">10000000</span>);</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> (exception != <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> (monoWait == SCRIPTING_NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        m_RefCount++;</span><br><span class="line">        CallDelayed (ContinueCoroutine, m_Behaviour, <span class="number">0.0F</span>, <span class="keyword">this</span>, <span class="number">0.0F</span>, CleanupCoroutine, DelayedCallManager::kRunDynamicFrameRate | DelayedCallManager::kWaitForNextFrame);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HandleIEnumerableCurrentReturnValue(monoWait);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Coroutine::HandleIEnumerableCurrentReturnValue(ScriptingObjectPtr monoWait)</span><br><span class="line">&#123;</span><br><span class="line">    AsyncOperation* async = <span class="literal">NULL</span>;</span><br><span class="line">    ScriptingClassPtr waitClass = scripting_object_get_class (monoWait, GetScriptingTypeRegistry());</span><br><span class="line">    <span class="keyword">const</span> CommonScriptingClasses&amp; classes = GetMonoManager ().GetCommonClasses ();</span><br><span class="line">            </span><br><span class="line">    <span class="comment">// Continue the coroutine in 'wait' seconds</span></span><br><span class="line">    <span class="keyword">if</span> (scripting_class_is_subclass_of (waitClass, classes.waitForSeconds))</span><br><span class="line">    &#123;</span><br><span class="line">        m_RefCount++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> wait;</span><br><span class="line">        MarshallManagedStructIntoNative(monoWait,&amp;wait);</span><br><span class="line">        CallDelayed (ContinueCoroutine, m_Behaviour, wait, <span class="keyword">this</span>, <span class="number">0.0F</span>, CleanupCoroutine, DelayedCallManager::kRunDynamicFrameRate | DelayedCallManager::kWaitForNextFrame);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Continue the coroutine on the next fixed update</span></span><br><span class="line">    <span class="keyword">if</span> (scripting_class_is_subclass_of (waitClass, classes.waitForFixedUpdate))</span><br><span class="line">    &#123;</span><br><span class="line">        m_RefCount++;</span><br><span class="line">        CallDelayed (ContinueCoroutine, m_Behaviour, <span class="number">0.0F</span>, <span class="keyword">this</span>, <span class="number">0.0F</span>, CleanupCoroutine, DelayedCallManager::kRunFixedFrameRate);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Continue the coroutine at the end of frame</span></span><br><span class="line">    <span class="keyword">if</span> (scripting_class_is_subclass_of (waitClass, classes.waitForEndOfFrame))</span><br><span class="line">    &#123;</span><br><span class="line">        m_RefCount++;</span><br><span class="line">        CallDelayed (ContinueCoroutine, m_Behaviour, <span class="number">0.0F</span>, <span class="keyword">this</span>, <span class="number">0.0F</span>, CleanupCoroutine, DelayedCallManager::kEndOfFrame);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Continue after another coroutine is finished</span></span><br><span class="line">    <span class="keyword">if</span> (scripting_class_is_subclass_of (waitClass, classes.coroutine))</span><br><span class="line">    &#123;</span><br><span class="line">        Coroutine* waitForCoroutine;</span><br><span class="line">        MarshallManagedStructIntoNative(monoWait,&amp;waitForCoroutine);                </span><br><span class="line">        <span class="keyword">if</span> (waitForCoroutine-&gt;m_DoneRunning)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// continue executing.</span></span><br><span class="line">            ContinueCoroutine(m_Behaviour, <span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (waitForCoroutine-&gt;m_ContinueWhenFinished != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            LogStringObject (<span class="string">"Another coroutine is already waiting for this coroutine!\nCurrently only one coroutine can wait for another coroutine!"</span>, m_Behaviour);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        m_RefCount++;</span><br><span class="line">        waitForCoroutine-&gt;m_ContinueWhenFinished = <span class="keyword">this</span>;</span><br><span class="line">        m_WaitingFor = waitForCoroutine;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> ENABLE_WWW</span></span><br><span class="line">    <span class="comment">// Continue after fetching an www object is done</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> (classes.www &amp;&amp; scripting_class_is_subclass_of (waitClass, classes.www ))</span><br><span class="line">    &#123;</span><br><span class="line">        WWW* wwwptr;</span><br><span class="line">        MarshallManagedStructIntoNative(monoWait,&amp;wwwptr);</span><br><span class="line">        <span class="keyword">if</span>(wwwptr != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            m_RefCount++;</span><br><span class="line">            wwwptr-&gt;CallWhenDone (ContinueCoroutine, m_Behaviour, <span class="keyword">this</span>, CleanupCoroutine);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// Continue after fetching an www object is done</span></span><br><span class="line">    <span class="keyword">if</span> ((scripting_class_is_subclass_of (waitClass, classes.asyncOperation)) &amp;&amp; (async = ScriptingObjectWithIntPtrField&lt;AsyncOperation&gt; (monoWait).GetPtr()) != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        m_RefCount++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (async-&gt;IsDone())</span><br><span class="line">        &#123;</span><br><span class="line">            CallDelayed (ContinueCoroutine, m_Behaviour, <span class="number">0.0F</span>, <span class="keyword">this</span>, <span class="number">0.0F</span>, CleanupCoroutine, DelayedCallManager::kRunDynamicFrameRate | DelayedCallManager::kRunDynamicFrameRate | DelayedCallManager::kWaitForNextFrame);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Use AysncOperation ContinueCoroutine - default path</span></span><br><span class="line">        <span class="keyword">if</span> (async-&gt;HasCoroutineCallback ())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">////@<span class="doctag">TODO:</span> Throw exception?</span></span><br><span class="line">            ErrorString(<span class="string">"This asynchronous operation is already being yielded from another coroutine. An asynchronous operation can only be yielded once."</span>);</span><br><span class="line">            CallDelayed (ContinueCoroutine, m_Behaviour, <span class="number">0.0F</span>, <span class="keyword">this</span>, <span class="number">0.0F</span>, CleanupCoroutine, DelayedCallManager::kRunDynamicFrameRate | DelayedCallManager::kRunDynamicFrameRate | DelayedCallManager::kWaitForNextFrame);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        async-&gt;SetCoroutineCallback(ContinueCoroutine, m_Behaviour, <span class="keyword">this</span>, CleanupCoroutine);</span><br><span class="line">        m_AsyncOperation = async;</span><br><span class="line">        m_AsyncOperation-&gt;Retain();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Continue the coroutine on the next dynamic frame update</span></span><br><span class="line">    m_RefCount++;</span><br><span class="line">    CallDelayed (ContinueCoroutine, m_Behaviour, <span class="number">0.0F</span>, <span class="keyword">this</span>, <span class="number">0.0F</span>, CleanupCoroutine, DelayedCallManager::kRunDynamicFrameRate | DelayedCallManager::kRunDynamicFrameRate | DelayedCallManager::kWaitForNextFrame);</span><br><span class="line">    <span class="comment">//Ext_MarshalMap_Release_ScriptingObject(monoWait);//RH TODO : RELEASE THE MONOWAIT OBJECTS SOMEWHERE</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h2 id="MonoBehaviour-cpp"><a href="#MonoBehaviour-cpp" class="headerlink" title="MonoBehaviour.cpp"></a>MonoBehaviour.cpp</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Coroutine* MonoBehaviour::CreateCoroutine(ScriptingObjectPtr userCoroutine, ScriptingMethodPtr method)</span><br><span class="line">&#123;</span><br><span class="line">    ScriptingMethodPtr moveNext = scripting_object_get_virtual_method(userCoroutine, MONO_COMMON.IEnumerator_MoveNext, GetScriptingMethodRegistry());</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !UNITY_FLASH</span></span><br><span class="line">    ScriptingMethodPtr current = scripting_object_get_virtual_method(userCoroutine, MONO_COMMON.IEnumerator_Current, GetScriptingMethodRegistry());</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="comment">//todo: make flash use generic path. set a bogus value for flash here right now so it passes current != NULL check,  flash path will never use this value for now.</span></span><br><span class="line">    ScriptingMethodPtr current = (ScriptingMethodPtr)<span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (current == SCRIPTING_NULL || moveNext == SCRIPTING_NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> message = (method != SCRIPTING_NULL) ? Format (<span class="string">"Coroutine '%s' couldn't be started!"</span>, scripting_method_get_name(method)) : <span class="string">"Coroutine couldn't be started!"</span>;</span><br><span class="line">        LogStringObject (message, <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Coroutine* coroutine = <span class="keyword">new</span> Coroutine ();</span><br><span class="line">    </span><br><span class="line">    coroutine-&gt;m_CoroutineEnumeratorGCHandle = scripting_gchandle_new (userCoroutine);</span><br><span class="line">    coroutine-&gt;m_CoroutineEnumerator = userCoroutine;</span><br><span class="line">    coroutine-&gt;m_CoroutineMethod = method;</span><br><span class="line">    coroutine-&gt;SetMoveNextMethod(moveNext);</span><br><span class="line">    coroutine-&gt;SetCurrentMethod(current);</span><br><span class="line">    coroutine-&gt;m_Behaviour = <span class="keyword">this</span>;</span><br><span class="line">    coroutine-&gt;m_ContinueWhenFinished = <span class="literal">NULL</span>;</span><br><span class="line">    coroutine-&gt;m_WaitingFor = <span class="literal">NULL</span>;</span><br><span class="line">    coroutine-&gt;m_AsyncOperation = <span class="literal">NULL</span>;</span><br><span class="line">    coroutine-&gt;m_RefCount = <span class="number">1</span>;</span><br><span class="line">    coroutine-&gt;m_IsReferencedByMono = <span class="number">0</span>;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE</span></span><br><span class="line">    printf_console (<span class="string">"Allocate coroutine %d\n"</span>, coroutine);</span><br><span class="line">    AssertIf(GetDelayedCallManager().HasDelayedCall(coroutine-&gt;m_Behaviour, Coroutine::ContinueCoroutine, CompareCoroutine, coroutine));</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> DEBUG_COROUTINE_LEAK            </span></span><br><span class="line">    printf_console (<span class="string">"Active coroutines %d\n"</span>, gCoroutineCounter);</span><br><span class="line">    gCoroutineCounter++;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    m_ActiveCoroutines.push_back (*coroutine);</span><br><span class="line">    AssertIf(&amp;m_ActiveCoroutines.back() != coroutine);</span><br><span class="line">    m_ActiveCoroutines.back ().Run ();</span><br><span class="line"></span><br><span class="line">    AssertIf(coroutine-&gt;m_RefCount == <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (coroutine-&gt;m_RefCount &lt;= <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Coroutine::CleanupCoroutine(coroutine);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Coroutine::CleanupCoroutine(coroutine);</span><br><span class="line">    <span class="keyword">return</span> coroutine;               </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了，入口我们找到了，那么它是运行的呢？我们跟踪run的时候会发现有一个CallDelaye函数，而这个函数是一个定时器函数，内部最终在Update上执行，那么我们的目标转而它的Update在哪里执行的呢？我们继续看。<br>我们发现它最终是在场景的中Tick执行的，但是我目前并未发现Tick是多线程执行的，而且在个人的理解中，Tick也不太会或者不敢用多线程。</p>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>通过Unity2018上测试发现LoadFromFileAsync是使用多线程，协程在主线程上跑，这看上去符合我们的实验结果。<br>而从Unity4.7源码发现协程是在主线程中运行。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">liyanfeng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">330</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">97</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liyanfeng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  

    </div>
</body>
</html>
