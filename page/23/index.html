<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zentia.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"W8FJT5MTZU","apiKey":"f4ca7ae2408d2e27ffc8269ad8d34273","indexName":"hexo","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="liyanfeng">
<meta property="og:url" content="http://zentia.github.io/page/23/index.html">
<meta property="og:site_name" content="liyanfeng">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="liyanfeng">

<link rel="canonical" href="http://zentia.github.io/page/23/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>liyanfeng</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">liyanfeng</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/21/Unity-Mesh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/21/Unity-Mesh/" class="post-title-link" itemprop="url">Unity Mesh</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-21 14:39:23" itemprop="dateCreated datePublished" datetime="2018-04-21T14:39:23+08:00">2018-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Mesh是Unity内的一个组件，成为网格组件。</p>
<ul>
<li>Mesh网格</li>
<li>MeshFilter网格过滤器</li>
<li>Mesh Renderer 网格渲染器</li>
</ul>
<p>Mesh: 是指模型的网格，建模就是建网格。Mesh的主要属性内容包括顶点坐标，法线，纹理坐标，三角形绘制序列等其他有用属性和功能。因此建网格，就是画三角形；画三角形就是定位三个点。<br>Mesh Filter: 内包含一个Mesh组件，可以根据MeshFilter获得网格的组件，也可以为MeshFilter设置Mesh内容。<br>Mesh Renderer: 是用于把网格渲染出来的组件。MeshFilter的作用就是把Mesh扔给MeshRender将模型或者是几何体绘制显示出来。</p>
<p>它们之间的关系大概就是GameObject挂MeshFilter组件，该组件有Mesh属性，该属性存顶点坐标，法线等属性，然后用Mesh Renderer(SkinMeshRenderer)才能将此网格渲染出来。</p>
<h3 id="Mesh属性"><a href="#Mesh属性" class="headerlink" title="Mesh属性"></a>Mesh属性</h3><ul>
<li>顶点坐标(vertex) 顶点坐标数组存放Mesh的每个顶点空间坐标，假设某mesh有n个顶点，则vertex的size为n</li>
<li>法线(normal) 法线数组存放mesh每个顶点的法线，大小与顶点坐标对应，normal[i]对应vector[i]的法线</li>
<li>纹理坐标(uv) 它定义了图片上每个点的位置的信息，这些点与3D模型是互相联系的，以决定表面纹理贴图的位置，UV就是将图像上每个点精确对应到模型物体的表面uv[i]对应vectex[i]</li>
<li>三角形序列(triangle) 每个mesh都由若干个三角形组成，而三角形的三个点就是顶点坐标里的点，三角形的数组的size - 三角形个数 * 3</li>
</ul>
<p>例如：某mesh有四个顶点0,1,2,3<br>v0( 1, 1, 0)<br>v1(-1, 1, 0)<br>V2( 1,-1, 0)<br>V3(-1,-1, 0)<br>那么它们可以组成这样的一个网格<br>tri[0] = v0,v3,v1, tri[1] = v0, v2, v3</p>
<p>注意：三角形的顶点顺序必须是顺时针，顺时针表示正面，逆时针表示背面，而Unity3D在渲染默认只渲染正面，背面是看不见的。(双面渲染一般用于头发等材质的处理)<br>那么该三角形可以表示:</p>
<pre><code>tri = new int[2 * 3]{0,3,1, 0, 2, 3};
</code></pre><p>如何要获取第N个三角形对应的三个顶点坐标，则:V1 = tri[N <em> 3+0],v2 = tri[N </em> 3 + 1], v3 = tri[N * 3 + 2]</p>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="comment">//注意Unity是左手坐标系！！！，Unity默认是不渲染背面的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CreateMesh</span> : <span class="title">MonoBehaviour</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> MeshFilter filter;</span><br><span class="line">    <span class="keyword">private</span> Mesh mesh;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        filter = GetComponent&lt;MeshFilter&gt;();</span><br><span class="line">        mesh = <span class="keyword">new</span> Mesh();</span><br><span class="line">        filter.mesh = mesh;</span><br><span class="line">        InitMesh();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InitMesh</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        mesh.name = <span class="string">"MyMesh"</span>;</span><br><span class="line">        Vector3[] vertics = <span class="keyword">new</span> Vector3[<span class="number">8</span>]&#123;</span><br><span class="line">            <span class="keyword">new</span> Vector3(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>),</span><br><span class="line">            <span class="keyword">new</span> Vector3(<span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">            <span class="keyword">new</span> Vector3(<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>),</span><br><span class="line">            <span class="keyword">new</span> Vector3(<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">0</span>),</span><br><span class="line">            <span class="keyword">new</span> Vector3(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">            <span class="keyword">new</span> Vector3(<span class="number">-1</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">            <span class="keyword">new</span> Vector3(<span class="number">1</span>,<span class="number">-1</span>,<span class="number">1</span>),</span><br><span class="line">            <span class="keyword">new</span> Vector3(<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        mesh.vertices = vertics;</span><br><span class="line">        <span class="keyword">int</span>[] triangles = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">12</span> * <span class="number">3</span>]&#123;</span><br><span class="line">            <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">            <span class="number">4</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">4</span>,</span><br><span class="line">            <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">6</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">2</span>,</span><br><span class="line">            <span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        mesh.triangles = triangles;</span><br><span class="line">        <span class="comment">/*Vector2[] uv = new Vector2[4]&#123;</span></span><br><span class="line"><span class="comment">            new Vector2(1,1),</span></span><br><span class="line"><span class="comment">            new Vector2(0,1),</span></span><br><span class="line"><span class="comment">            new Vector2(1,0),</span></span><br><span class="line"><span class="comment">            new Vector2(0,0)</span></span><br><span class="line"><span class="comment">        &#125;;</span></span><br><span class="line"><span class="comment">        mesh.uv = uv;*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下(一定要加Mesh Renderer因为这玩意是负责渲染的,Unity这货材质缺失就是显示粉色的)<br><img src="http://oxcvfpext.bkt.clouddn.com/Unity-Mesh-2.png"></p>
<p>网格已经生成了，接下来就是给网格贴图了，uv属性会直接控制贴显示贴图的哪一部分，以及如何显示贴图uv中的每一项和vertices的每一项都是一一对应的，unity在贴图的时候，会把uv中的每一个点和vertices中对应的索引的顶点一一关联起来，这样可以实现贴图任意形状实现<br>最终效果<br><img src="http://oxcvfpext.bkt.clouddn.com/Unity-Mesh-3.png"></p>
<h3 id="shared"><a href="#shared" class="headerlink" title="shared"></a>shared</h3><p>在源对象上修改属性，非shared每次修改属性会从新生成一个对象。<br>在编辑器下非运行期如果使用shared会修改本地文件，如果使用非shared会提示内存泄漏。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/20/cocos2d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/20/cocos2d/" class="post-title-link" itemprop="url">cocos2d</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-20 19:28:10" itemprop="dateCreated datePublished" datetime="2018-04-20T19:28:10+08:00">2018-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/20/xxsy-client-framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/20/xxsy-client-framework/" class="post-title-link" itemprop="url">寻仙手游客户端分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-20 18:55:07" itemprop="dateCreated datePublished" datetime="2018-04-20T18:55:07+08:00">2018-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>寻仙手游客户端是采用Unity5.3.8+uLua开发的一款MMORPG手游。</p>
<h1 id="流程顺序"><a href="#流程顺序" class="headerlink" title="流程顺序"></a>流程顺序</h1><p>应用程序启动<br>Handheld.PlayFullScreenMovie通过该方法播放视频文件<br>进入更新模块<br>SDK初始化安卓通过AndroidJavaClass访问Java实例</p>
<h1 id="资源模块"><a href="#资源模块" class="headerlink" title="资源模块"></a>资源模块</h1><h1 id="UI模块"><a href="#UI模块" class="headerlink" title="UI模块"></a>UI模块</h1><h1 id="更新模块"><a href="#更新模块" class="headerlink" title="更新模块"></a>更新模块</h1><h1 id="网络模块"><a href="#网络模块" class="headerlink" title="网络模块"></a>网络模块</h1><p>这里是在多线程中做的，使用的是NetworkStream这个。</p>
<h1 id="Lua模块"><a href="#Lua模块" class="headerlink" title="Lua模块"></a>Lua模块</h1><h2 id="Lua-注册"><a href="#Lua-注册" class="headerlink" title="Lua 注册"></a>Lua 注册</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">MonoInvokeCallbackAttribute(typeof(LuaCSFunction))</span>]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">call</span>(<span class="params">System.IntPtr L</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> upidx = LuaDLL.lua_upvalueindex(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> fnidx = (<span class="keyword">int</span>)LuaDLL.lua_touserdata(L, upidx);</span><br><span class="line">    <span class="keyword">if</span> (fnidx &lt;= || fnidx &gt; m_count)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaDLL.luaL_error(L, <span class="string">"SafeCallApi : bad function index "</span> + fnidx);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> info = m_infos[fnidx - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (L != LuaMgr.m_L)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">new</span> GuardL &#123; L = LuaMgr.m_L&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                LuaMgr.m_L = L;</span><br><span class="line">                <span class="keyword">int</span> v = info.function();</span><br><span class="line">                <span class="keyword">return</span> v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> r = info.function();</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (System.Exception err)</span><br><span class="line">    &#123;</span><br><span class="line">        LuaDLL.lua_pushstring(L, <span class="string">"SafeCallApi : exception \n"</span> + err.ToString());</span><br><span class="line">    &#125;</span><br><span class="line">    LuaDll.lua_error(L);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="技能模块"><a href="#技能模块" class="headerlink" title="技能模块"></a>技能模块</h1><h1 id="角色模块"><a href="#角色模块" class="headerlink" title="角色模块"></a>角色模块</h1><h1 id="动画模块"><a href="#动画模块" class="headerlink" title="动画模块"></a>动画模块</h1><h1 id="状态模块"><a href="#状态模块" class="headerlink" title="状态模块"></a>状态模块</h1><h1 id="CD模块"><a href="#CD模块" class="headerlink" title="CD模块"></a>CD模块</h1><h1 id="状态模块-1"><a href="#状态模块-1" class="headerlink" title="状态模块"></a>状态模块</h1><h1 id="场景模块"><a href="#场景模块" class="headerlink" title="场景模块"></a>场景模块</h1><h1 id="子物体模块"><a href="#子物体模块" class="headerlink" title="子物体模块"></a>子物体模块</h1><h1 id="同屏系统"><a href="#同屏系统" class="headerlink" title="同屏系统"></a>同屏系统</h1><p>每个场景里一般都有很多对象，对其中一个对象而言，它一般只关注自己周围一定范围内的其它对象。同屏系统的主要工作就是将对象周围一定范围内的其它对象精确且高效的统计，为客户端的表现以及其它系统提供服务。</p>
<p>我们采取的思想是每个对象维护了一个同屏信息，同屏信息主要包括同屏对象列表和同屏玩家列表。</p>
<p>导致同屏信息表改变的原因主要有三个：新对象进入场景，对象位置改变，对象离开场景。<br>针对以上三种原因我们采取了两种实现机制：定时更新机制，立刻更新机制。<br>立刻更新机制：<br>    主要针对对象离开场景的情况。<br>    实现步骤主要是根据离开对象记录的同屏信息，再相关联对象和自己的同屏信息内相互去掉。<br>定时更新机制：<br>    主要针对对象进入场景和对象位置改变两个原因。<br>    针对对象进入场景原因实现主要是对象进入场景时，设置新对象标记。然后通过定时更新实现同屏信息变化。<br>    针对对象位置改变原因实现步骤主要是对象位置改变，设置位置变更标记。然后通过定时更新实现同屏信息变化。<br>    定时更新机制是每个tick对场景内所有本tick进行过位置变化或者新进入的对象进行同屏信息更新。更新的主要逻辑是再同屏信息内的对象若离开同屏则进行清除和未在同屏信息内的玩家若满足进入同屏则加入。<br>    由于定时更新使用频繁且实现复杂，因此采取了搞笑的实现方法来实现这个功能。由于定时更新需要检测哪些对象进入同屏，如果整个检测整个场景内的对象，比较费，由此提出了单元格概念(CellSpace)，就是把场景划分N * N的格子，每个各自作为一个单元格，单元格内维护对象列表。然后再根据玩家的同屏距离，首先获得所在的单元戈，再判断对应单元格的对象是否进入对象同屏，减少判断数量。</p>
<p>游戏专用子系统<br>武器、道具、<br>游戏专用渲染<br>地形渲染、水体模拟及渲染<br>玩家机制<br>状态机及动画、相对摄像机的操控（HID）、碰撞流行、移动<br>游戏摄像机<br>固定设想、脚本/动画摄像机、跟踪玩家摄像机、调试用飞行摄像机<br>人工智能<br>目标及决策、动作（引擎接口）、视线追踪及感知、路径搜寻（A* ）<br>前端<br>平视显示器（HUD）、全动视频（FMV）、游戏内置电影（IGC）、游戏内置GUI、游戏内置菜单、包裹/吸引模式<br>视觉效果<br>光照贴图及动态阴影、高动态光照、PRT光照此表面散射、粒子及贴花系统、后处理效果、环境贴图<br>场景图/剔除优化<br>空间部分（BSP树）、遮挡及潜在可见集、纹理及表面管理、调试绘图（直线等）、图形设备接口<br>性能剖析及调试<br>录影及回放、内存及性能统计、游戏内菜单或控制台<br>游戏性基础<br>高层次的游戏流程系统/FSM<br>脚本系统<br>静态世界元素、动态游戏对象模型、实时基于代理人模拟、时间/信息系统、世界载入/串流<br>骨骼动画<br>动画状态树及蹭、反向动力学（IK）层阶式物体依附、游戏专用的后期处理、线性插值、动画播放、子骨骼播放、动画解压、骨骼网格渲染、布娃娃物理<br>在线多人<br>安排比赛及游戏管理、对象管辖权策略、游戏状态复制<br>音频<br>DSP/效果、三维音频模型、音频播放/管理<br>低阶渲染器<br>材质及着色器、静态及动态光源、摄像机、文本及字体、几何图元提交、视区及虚拟屏幕、纹理及表面管理、调试绘图（直线等）、图形设备接口<br>碰撞及物理<br>力及约束、光线/形状投影（查询）、刚体、Phantom、形状/可碰撞体、物理/碰撞世界<br>人体学接口设备（HID）<br>游戏专用接口、物理设备I/O<br>资源（游戏资产）<br>三维模型资源、纹理资源、材质资源、字体资源、骨骼资源、碰撞资源、物理参数、游戏世界/地图、其他<br>核心系统<br>模块启动及终止、断言、单元测试、内存分配、数学库、字符串及散列字符串标识符、调试用打印及日志、本地化服务、影片播放器、语法分析器（CSV、XML等）、性能剖析/统计采集、引擎配置（INI文件等）、随机数生成器、曲线及曲圆库、RITI/反射/序列化、对象句柄/唯一标识符、异步文件I/O<br>平台独立层<br>平台检测、原子数据类型、集合及迭代器、文件系统、网络传播层（UDP/TCP）、高分辨率时钟、线程库、图形包裹类、物理/碰撞包裹类<br>第三方软件开发包<br>DirectX\OpenGL、Boost、STL/STLPort</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/18/Net-Net-Framework-mono/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/18/Net-Net-Framework-mono/" class="post-title-link" itemprop="url">.Net .Net Framework mono</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-18 20:50:22" itemprop="dateCreated datePublished" datetime="2018-04-18T20:50:22+08:00">2018-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:37" itemprop="dateModified" datetime="2021-06-17T10:39:37+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>.net从一个抽象上来说其实是一个理念，使多种语言编写的程序能够通过一个通用的Runtime运行在不同的操作系统及硬件平台上。比如.net framework是在windows上实现的.net platform,mono是一个跨平台的.net platform<br>一个.net platform想到达到.net的目标，就需要一些组件，比如CLR(Common Language Runtime),比如FCL基础类库，比如各种语言编译器，编译器编译出来的东西想要在CLR中运行，那也需要遵循一定的标准，这就是CLI和CIL，CIL规定了编译输出的规则，而CLI规定了编译器输入语言的规则，只有符合这种标准的语言才能编译成CIL语言运行在CLR中。<br>好了现在有CIL和CLR，可以用符合CLI的语言比如C#编写程序了，然后将其编译成CIL，最后在CLR中运行<br>Unity能跨平台的原因就是实现了各个平台的”即时编译器”(C#代码-&gt;中间语言-&gt;各个平台的原生代码)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/17/C-0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/17/C-0/" class="post-title-link" itemprop="url">减少装箱(Boxing)和拆箱(UnBoxing)操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-17 20:38:08" itemprop="dateCreated datePublished" datetime="2018-04-17T20:38:08+08:00">2018-04-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:37" itemprop="dateModified" datetime="2021-06-17T10:39:37+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>.Net的类型分值类型和引用类型，这两个类型的本质区别，值类型数据是分配在栈中，而引用类型数据分配在堆上，那么如果要把一个值类型数据放到堆上，就需要装箱操作；反之，把一个放在堆上的值类型数据取出来，则需要拆箱操作。<br>减少装箱和拆箱操作的好处</p>
<ul>
<li>对于堆的操作效率比较低</li>
<li>堆上分配的内存资源，需要GC来回收，从而降低程序效率</li>
</ul>
<p>格式化操作有较多的装箱拆箱操作，比如String.Format, Console.WriteLine之类的语句，</p>
<pre><code>Console.WriteLine(&quot;Number list:{0}, {1}, {2}&quot;, 1.ToString(), t.2ToString(), 3.ToString())
</code></pre><p>由于1.ToString()的结果是String类型，属于引用类型，因此不涉及装箱拆箱操作；</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/17/Unity-ECS-README/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/17/Unity-ECS-README/" class="post-title-link" itemprop="url">Unity ECS Readme</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-17 19:47:16" itemprop="dateCreated datePublished" datetime="2018-04-17T19:47:16+08:00">2018-04-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p align="center">
    <a href="https://gitter.im/sschmid/Entitas-CSharp?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge" target="_blank" rel="noopener">
        <img src="https://img.shields.io/badge/chat-on%20gitter-brightgreen.svg" alt="Join the chat at https://gitter.im/sschmid/Entitas-CSharp"></a>
    <a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fgithub.com%2Fsschmid%2FEntitas-CSharp&screen_name=s_schmid&tw_p=followbutton" target="_blank" rel="noopener">
        <img src="https://img.shields.io/badge/twitter-follow%20%40s__schmid-blue.svg" alt="Twitter Follow Me"></a>
    <a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fgithub.com%2Fsschmid%2FEntitas-CSharp&screen_name=entitas_csharp&tw_p=followbutton" target="_blank" rel="noopener">
        <img src="https://img.shields.io/badge/twitter-follow%20%40entitas__csharp-blue.svg" alt="Twitter Follow Me"></a>
    <a href="https://travis-ci.org/sschmid/Entitas-CSharp" target="_blank" rel="noopener">
        <img src="https://travis-ci.org/sschmid/Entitas-CSharp.svg?branch=master" alt="Build Status"></a>
    <a href="https://github.com/sschmid/Entitas-CSharp/releases" target="_blank" rel="noopener">
        <img src="https://img.shields.io/github/release/sschmid/Entitas-CSharp.svg" alt="Latest release"></a>
</p>

<h1 id="Entitas-The-Entity-Component-System-Framework-for-C-and-Unity"><a href="#Entitas-The-Entity-Component-System-Framework-for-C-and-Unity" class="headerlink" title="Entitas - The Entity Component System Framework for C# and Unity"></a>Entitas - The Entity Component System Framework for C# and Unity</h1><p>Entitas is a super fast Entity Component System Framework (ECS) specifically made for C# and Unity. Internal caching and blazing fast component access makes it second to none. Several design decisions have been made to work optimal in a garbage collected environment and to go easy on the garbage collector. Entitas comes with an optional code generator which radically reduces the amount of code you have to write and <a href="https://cleancoders.com" title="Clean Coders" target="_blank" rel="noopener">makes your code read like well written prose.</a></p>
<hr>
<h3 id="»-Download"><a href="#»-Download" class="headerlink" title="» Download"></a><strong><a href="#download-entitas">» Download</a></strong></h3><h3 id="»-Documentation"><a href="#»-Documentation" class="headerlink" title="» Documentation"></a><strong><a href="http://sschmid.github.io/Entitas-CSharp/" title="Entitas Documentation" target="_blank" rel="noopener">» Documentation</a></strong></h3><h3 id="»-Ask-a-question"><a href="#»-Ask-a-question" class="headerlink" title="» Ask a question"></a><strong><a href="https://github.com/sschmid/Entitas-CSharp/issues/new" title="New issue" target="_blank" rel="noopener">» Ask a question</a></strong></h3><h3 id="»-Wiki-and-example-projects"><a href="#»-Wiki-and-example-projects" class="headerlink" title="» Wiki and example projects"></a><strong><a href="https://github.com/sschmid/Entitas-CSharp/wiki" title="Entitas Wiki" target="_blank" rel="noopener">» Wiki and example projects</a></strong></h3><h3 id="»-madeWithEntitas"><a href="#»-madeWithEntitas" class="headerlink" title="» #madeWithEntitas"></a><strong><a href="https://github.com/sschmid/Entitas-CSharp/wiki/Made-With-Entitas" title="Wiki - #madeWithEntitas" target="_blank" rel="noopener">» #madeWithEntitas</a></strong></h3><hr>
<h1 id="Video-Tutorials-amp-Unity-Unite-Talks"><a href="#Video-Tutorials-amp-Unity-Unite-Talks" class="headerlink" title="Video Tutorials &amp; Unity Unite Talks"></a>Video Tutorials &amp; Unity Unite Talks</h1><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Entitas ECS Unity Tutorial</th>
<th style="text-align:center">Entitas ECS Unity Tutorial</th>
<th style="text-align:center">Entity system architecture with Unity</th>
<th style="text-align:center">ECS architecture with Unity by example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="https://www.youtube.com/watch?v=L-18XRTarOM" title="Video: Entitas - Shmup - Part 1" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/sschmid/Entitas-CSharp/master/Readme/Images/Entitas-Shmup-Part-1.jpg" alt="Shmup1" title="Video: Entitas - Shmup - Part 1"></a></td>
<td style="text-align:center"><a href="https://www.youtube.com/watch?v=DZpvUnj2dGI" title="Video: Entitas - Shmup - Part 2" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/sschmid/Entitas-CSharp/master/Readme/Images/Entitas-Shmup-Part-2.jpg" alt="Shmup2" title="Video: Entitas - Shmup - Part 2"></a></td>
<td style="text-align:center"><a href="https://www.youtube.com/watch?v=Re5kGtxTW6E" title="Video: Watch the Entitas Talk at Unite Europe 2015" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/sschmid/Entitas-CSharp/master/Readme/Images/UniteEurope2015-Video.png" alt="Unite 15" title="Video: Watch the Entitas Talk at Unite Europe 2015"></a></td>
<td style="text-align:center"><a href="https://www.youtube.com/watch?v=Phx7IJ3XUzg" title="Video: Watch the Entitas Talk at Unite Europe 2016" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/sschmid/Entitas-CSharp/master/Readme/Images/UniteEurope2016-Video.png" alt="Unite 16" title="Video: Watch the Entitas Talk at Unite Europe 2016"></a></td>
</tr>
<tr>
<td style="text-align:center">Setup &amp; Basics</td>
<td style="text-align:center">Git &amp; Unit Tests</td>
<td style="text-align:center"><a href="http://www.slideshare.net/sschmid/uniteeurope-2015" title="SlideShare: Unite Europe 2015" target="_blank" rel="noopener">» Open the slides on SlideShare: Unite Europe 2015</a></td>
<td style="text-align:center"><a href="http://www.slideshare.net/sschmid/uniteeurope-2016" title="SlideShare: Unite Europe 2016" target="_blank" rel="noopener">» Open the slides on SlideShare: Unite Europe 2016</a></td>
</tr>
</tbody>
</table>
</div>
<h1 id="First-glimpse"><a href="#First-glimpse" class="headerlink" title="First glimpse"></a>First glimpse</h1><p>The optional <a href="https://github.com/sschmid/Entitas-CSharp/wiki/Code-Generator" title="Wiki - Code Generator" target="_blank" rel="noopener">code generator</a> lets you write code that is super fast, safe and literally screams its intent.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GameEntity <span class="title">CreateRedGem</span>(<span class="params"><span class="keyword">this</span> GameContext context, Vector3 position</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entity = context.CreateEntity();</span><br><span class="line">    entity.isGameBoardElement = <span class="literal">true</span>;</span><br><span class="line">    entity.isMovable = <span class="literal">true</span>;</span><br><span class="line">    entity.AddPosition(position);</span><br><span class="line">    entity.AddAsset(<span class="string">"RedGem"</span>);</span><br><span class="line">    entity.isInteractive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> entity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> entities = context.GetEntities(Matcher&lt;GameEntity&gt;.AllOf(GameMatcher.Position, GameMatcher.Velocity));</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">var</span> e <span class="keyword">in</span> entities) &#123;</span><br><span class="line">    <span class="keyword">var</span> pos = e.position;</span><br><span class="line">    <span class="keyword">var</span> vel = e.velocity;</span><br><span class="line">    e.ReplacePosition(pos.<span class="keyword">value</span> + vel.<span class="keyword">value</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>Entitas is fast, light and gets rid of unnecessary complexity. There are less than a handful classes you have to know to rocket start your game or application:</p>
<ul>
<li>Entity</li>
<li>Context</li>
<li>Group</li>
<li>Entity Collector</li>
</ul>
<p><a href="https://github.com/sschmid/Entitas-CSharp/wiki/Overview" title="Wiki - Overview" target="_blank" rel="noopener">Read more…</a></p>
<h1 id="Code-Generator"><a href="#Code-Generator" class="headerlink" title="Code Generator"></a>Code Generator</h1><p>The Code Generator generates classes and methods for you, so you can focus on getting the job done. It radically reduces the amount of code you have to write and improves readability by a huge magnitude. It makes your code less error-prone while ensuring best performance. I strongly recommend using it!</p>
<p><a href="https://github.com/sschmid/Entitas-CSharp/wiki/Code-Generator" title="Wiki - Code Generator" target="_blank" rel="noopener">Read more…</a></p>
<h1 id="Unity-integration"><a href="#Unity-integration" class="headerlink" title="Unity integration"></a>Unity integration</h1><p>The optional Unity module integrates Entitas nicely into Unity and provides powerful editor extensions to inspect and debug contexts, groups, entities, components and systems.</p>
<p><a href="https://github.com/sschmid/Entitas-CSharp/wiki/Unity-integration" title="Wiki - Unity Integration" target="_blank" rel="noopener">Read more…</a></p>
<p align="center">
    <img src="https://raw.githubusercontent.com/sschmid/Entitas-CSharp/master/Readme/Images/Entitas.Unity-MenuItems.png" alt="Entitas.Unity MenuItems" height="200"><br>
    <img src="https://raw.githubusercontent.com/sschmid/Entitas-CSharp/master/Readme/Images/Entitas.Unity.VisualDebugging-Entity.png" alt="Entitas.Unity.VisualDebugging Entity" width="400">
    <img src="https://raw.githubusercontent.com/sschmid/Entitas-CSharp/master/Readme/Images/Entitas.Unity.VisualDebugging-DebugSystems.png" alt="Entitas.Unity.VisualDebugging Systems" width="400">
</p>


<h1 id="Entitas-deep-dive"><a href="#Entitas-deep-dive" class="headerlink" title="Entitas deep dive"></a>Entitas deep dive</h1><p><a href="https://github.com/sschmid/Entitas-CSharp/wiki" title="Entitas Wiki" target="_blank" rel="noopener">Read the wiki</a> or checkout the <a href="https://github.com/sschmid/Entitas-CSharp/wiki/Example-projects" title="Wiki - Example Projects" target="_blank" rel="noopener">example projects</a> to see Entitas in action. These example projects illustrate how systems, groups, collectors and entities all play together seamlessly.</p>
<h1 id="Download-Entitas"><a href="#Download-Entitas" class="headerlink" title="Download Entitas"></a>Download Entitas</h1><p>Each release is published with zip files containing all source files you need.</p>
<p><a href="https://github.com/sschmid/Entitas-CSharp/releases" title="Releases" target="_blank" rel="noopener">Show releases</a></p>
<h1 id="Thanks-to"><a href="#Thanks-to" class="headerlink" title="Thanks to"></a>Thanks to</h1><p>Big shout out to <a href="https://github.com/mzaks" title="@mzaks" target="_blank" rel="noopener">@mzaks</a>, <a href="https://github.com/cloudjubei" title="@cloudjubei" target="_blank" rel="noopener">@cloudjubei</a> and <a href="https://github.com/devboy" title="@devboy" target="_blank" rel="noopener">@devboy</a> for endless hours of discussion and helping making Entitas awesome!</p>
<h1 id="Maintainer-s"><a href="#Maintainer-s" class="headerlink" title="Maintainer(s)"></a>Maintainer(s)</h1><ul>
<li><a href="https://github.com/sschmid" title="@sschmid" target="_blank" rel="noopener">@sschmid</a> | <a href="https://twitter.com/s_schmid" title="s_schmid on Twitter" target="_blank" rel="noopener">@s_schmid</a> | <a href="https://twitter.com/entitas_csharp" title="entitas_csharp on Twitter" target="_blank" rel="noopener">@entitas_csharp</a></li>
</ul>
<h1 id="Different-language"><a href="#Different-language" class="headerlink" title="Different language?"></a>Different language?</h1><p>Entitas is available in</p>
<ul>
<li><a href="https://github.com/sschmid/Entitas-CSharp" target="_blank" rel="noopener">C#</a></li>
<li><a href="https://github.com/mzaks/Entitas-Swift" target="_blank" rel="noopener">Swift</a></li>
<li><a href="https://github.com/JuDelCo/Entitas-Cpp" target="_blank" rel="noopener">C++</a></li>
<li><a href="https://github.com/wooga/entitas" target="_blank" rel="noopener">Objective-C</a></li>
<li><a href="https://github.com/Rubentxu/entitas-java" target="_blank" rel="noopener">Java</a></li>
<li><a href="https://github.com/Aenyhm/entitas-python" target="_blank" rel="noopener">Python</a></li>
<li><a href="https://github.com/darkoverlordofdata/entitas-scala" target="_blank" rel="noopener">Scala</a></li>
<li><a href="https://github.com/wooga/go-entitas" target="_blank" rel="noopener">Go</a></li>
<li><a href="https://github.com/darkoverlordofdata/entitas-fsharp" target="_blank" rel="noopener">F#</a></li>
<li><a href="https://github.com/darkoverlordofdata/entitas-ts" target="_blank" rel="noopener">TypeScript</a></li>
<li><a href="https://github.com/darkoverlordofdata/entitas-kotlin" target="_blank" rel="noopener">Kotlin</a></li>
<li><a href="https://github.com/mhaemmerle/entitas-haskell" target="_blank" rel="noopener">Haskell</a></li>
<li><a href="https://github.com/mhaemmerle/entitas_erl" target="_blank" rel="noopener">Erlang</a></li>
<li><a href="https://github.com/mhaemmerle/entitas-clj" target="_blank" rel="noopener">Clojure</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/16/Unity-Coroutine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/16/Unity-Coroutine/" class="post-title-link" itemprop="url">Unity ECS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-16 19:47:16" itemprop="dateCreated datePublished" datetime="2018-04-16T19:47:16+08:00">2018-04-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Coroutines"><a href="#Coroutines" class="headerlink" title="Coroutines"></a>Coroutines</h1><p>WaitForENdOffFrame 帧末尾执行<br>yield return null 表示暂缓一帧，在下一帧接着往下处理，于yield return 0 或 yield return 1一样的功能<br>yield return new WaitForSeconds<br>协程的真正用途是分布做一个比较耗时的事情，比如游戏里面的加载资源</p>
<h1 id="Unity面对的问题"><a href="#Unity面对的问题" class="headerlink" title="Unity面对的问题"></a>Unity面对的问题</h1><ul>
<li>面向对象的编程方式（曾经的圣典，已经跟不上时代，OOP最大的问题是数据和逻辑混在一起，而现在我们要数据驱动模型）</li>
<li>由Mono编译的非最优机器码</li>
<li>GC机制</li>
<li>单线程开发</li>
</ul>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2><ul>
<li>创建一个GameObject对象；</li>
<li>在对象上添加组件：Renderer，Collider，Rigidbody physics；</li>
<li>创建MonoBehaviour脚本并将其添加到对象中，以便在运行时控制和更改这些组件的状态属性；</li>
</ul>
<p>以上3个步骤执行，我们成为Unity的执行流程，作为Unity开发者来说，这个是最基本的流程。<br>但是这种做法有它自己的缺点和性能问题。比如数据和逻辑是紧密耦合的，这意味着代码重用的频率比较低，因为逻辑与特定数据相关联，无法单独分离出来。<br>例如下图所示的GameObject和Components实例中，GameObject依赖于Transform、Renderer、Rigidbody和Collder引用，这些脚本中的引用对象分散在堆内存中。</p>
<div align="center"></div>

<p>游戏对象、其行为及其组件之间的内存引用：</p>
<div align="center"><img src="/2018/04/16/Unity-Coroutine/2.png"></div>

<p>Unity GameObject场景可以让游戏在非常短的时间内完成原型构建并运行，这个也是Unity的特色可以让开发者快速入手，但它对于性能来说不太理想。我们在深层次的探讨这个问题，每个引用类型都包含可能不需要访问的许多额外数据，这些未使用的成员也占用了处理器缓存中的宝贵空间。比如我们继承的Mono就是一个典型的案例，如果只需要现有组件的极少功能接口函数或者变量，则可以将其余部分视为浪费空间，如下面的“浪费空间”图所示：</p>
<div align="center"><img src="/2018/04/16/Unity-Coroutine/3.jpg"></div>

<p>在上图中，粗体表示实际用于移动操作的成员，其余的就是浪费空间，若要移动GameObject，脚本需要从Transform组件访问位置和旋转数据成员。当硬件从内存中获取数据时，缓存航中会填充许多可能无用的数据，如果只是为所有应该移动的GameObjects设置一个只有位置和旋转成员的阵列，这将能够在很短的时间内执行，如何去掉无用的数据？ECS就是味解决此问题而设计的。</p>
<h1 id="ECS实体组件系统"><a href="#ECS实体组件系统" class="headerlink" title="ECS实体组件系统"></a>ECS实体组件系统</h1><p>Unity的新实体组件系统可帮助消除低效的对象引用，我们考虑只包含它所需数据的实体，而不考虑自带集合的GameObjects。<br>在下面的实体组件系统中，请注意Bullet实体没有附件Transform或Rigidbody组件，Bullet实体只是显示运行更新所需的原始数据，借助这个新系统，您可以将逻辑与各个对象类型完全分离。</p>
<div align="center"><img src="/2018/04/16/Unity-Coroutine/4.jpg"></div>

<p>这个系统具有很大的优势：它不仅可以提供缓存效率，缩短访问时间；它还支持在需要使用这种数据对齐方式的现代CPU中采用先进技术（自动矢量化/SIMD）这为游戏提供了所需的默认性能。如下图所示：</p>
<div align="center"><img src="/2018/04/16/Unity-Coroutine/5.jpg"></div>

<p>上图请注意缓冲行存储中的碎片和继承Mono系统生成的空间浪费，数据对比如下所示：</p>
<div align="center"><img src="/2018/04/16/Unity-Coroutine/6.jpg"></div>

<p>上图是将与单个移动操作相关的内存空间与实现系统目标的两个操作进行对比的结果。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/16/Unity-Manual/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/16/Unity-Manual/" class="post-title-link" itemprop="url">Unity Manual</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-16 19:01:26" itemprop="dateCreated datePublished" datetime="2018-04-16T19:01:26+08:00">2018-04-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>public static float Mathf.Round(float f)</td>
<td>四舍五入</td>
</tr>
</tbody>
</table>
</div>
<p>DisallowMultipleComponent 禁止一个脚本被加载多次</p>
<h3 id="YieldInstruction-中断指令"><a href="#YieldInstruction-中断指令" class="headerlink" title="YieldInstruction 中断指令"></a>YieldInstruction 中断指令</h3><p>所有yield指令的基类<br>参考WaitForSeconds, WaitForFixedUpdate, Coroutine and MonoBehaviour,StartCoroutine</p>
<h3 id="WaitForSeconds-等待几秒"><a href="#WaitForSeconds-等待几秒" class="headerlink" title="WaitForSeconds 等待几秒"></a>WaitForSeconds 等待几秒</h3><p>Namespace: UnityEngine<br>Inherits from: YieldInstruction</p>
<p>在给定的秒数内，暂停协同程序的执行。<br>WaitForSeconds只能用在协同程序中的yield声明。</p>
<h3 id="RequireComponent"><a href="#RequireComponent" class="headerlink" title="RequireComponent"></a>RequireComponent</h3><p>当你添加了一个用了RequireComponent组件的脚本，需要的组件将会自动被添加到GameObject上。这个可以有效避免组装错误。在新建类的前面加</p>
<pre><code>[RequireComponent(typeof(LineRenderer))]
</code></pre><h3 id="AssetDatabase-ImportAsset"><a href="#AssetDatabase-ImportAsset" class="headerlink" title="AssetDatabase.ImportAsset"></a>AssetDatabase.ImportAsset</h3><pre><code>static function ImportAsset(path : string, options : ImportAssetOptions = ImportAssetOptions.Default):void
</code></pre><p>导入指定路径的资源<br>所有路径都是相对于工程目录文件，例如”Assets/MyTexture/hello.png”</p>
<h3 id="AssetImporter-GetAtPath"><a href="#AssetImporter-GetAtPath" class="headerlink" title="AssetImporter.GetAtPath"></a>AssetImporter.GetAtPath</h3><pre><code>static function GetAtPath(path: string):AssetImporter
</code></pre><p>通过指定路径来导入资源</p>
<h3 id="TextureWrapMode"><a href="#TextureWrapMode" class="headerlink" title="TextureWrapMode"></a>TextureWrapMode</h3><p>在进行纹理贴图时，图像会出现在物体表面(u,v)位置上，而这些值在[0.0,1.0]范围内。但是，如果超出这个范围，会发生什么情况呢，这由纹理的映射函数来决定.常见有下面几种：</p>
<ol>
<li>重复(REPEAT):图像在表面上重复出现。在算法上，忽略纹理坐标的整数部分，并将纹理图的拷贝粘贴在物体表面上。对于大多数复制纹理的使用，在纹理顶部的纹理单元应于底部的纹理单元相匹配，在纹理左侧的纹理单元也应于右侧的纹理单元相匹配。</li>
<li>截取(CLAMP): 将大于1.0的数值设置为1.0，将小于0.0的数值设置为0.0，即将超出[0.0,1.0]范围的数值截取到[0.0,1.0]范围内，这样会导致纹理边缘的重复。</li>
<li>镜像重复(MIRRORED_REPEAT_ARB)</li>
<li>边界截取(CLAMP_TO_BORDER_ARB)</li>
<li>边缘截取(CLAMP_TO_EDGE)</li>
</ol>
<h3 id="CameraClearFlag"><a href="#CameraClearFlag" class="headerlink" title="CameraClearFlag"></a>CameraClearFlag</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> CameraClearFlags</span><br><span class="line">&#123;</span><br><span class="line">    Skybox = <span class="number">1</span>,			<span class="comment">// 这是默认设置，在屏幕上空的部分显示当前相机的天空盒。如果当前相机没有设置天空盒，它会默认使用Edit-&gt;Render Settings里)中选择天空盒。然后它将退回使用背景颜色，另外天空盒组件可以添加到相机上。</span></span><br><span class="line">    SolidColor = <span class="number">2</span>, <span class="comment">// 屏幕上的任何空的部分显示当前相机的背景颜色</span></span><br><span class="line">    Color = <span class="number">2</span>,</span><br><span class="line">    Depth = <span class="number">3</span>,			<span class="comment">// 该深度的东西永远都不会被裁剪</span></span><br><span class="line">    Nothing = <span class="number">4</span>,		<span class="comment">// 什么事情都不做</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Projector"><a href="#Projector" class="headerlink" title="Projector"></a>Projector</h3><pre><code>nearClipPlane       近裁剪面的距离
farClipPlane        远裁剪面的距离
fieldOfView         该投影的视野，以度为单位
aspectRatio         投影的宽高比
orthographic        投射是正交还是透视
orthographicSize    在正交模式下投射的一半尺寸
ignoreLayers        哪个物体层被这个投射器忽略
material            要投射到每个物体的材质
</code></pre><h2 id="Mesh"><a href="#Mesh" class="headerlink" title="Mesh"></a>Mesh</h2><h3 id="Mesh-RecalculateBounds"><a href="#Mesh-RecalculateBounds" class="headerlink" title="Mesh.RecalculateBounds"></a>Mesh.RecalculateBounds</h3><p>在修改完顶点后你应该用这个函数以确保包围体是恰当的。赋值三角形将自动重新计算包围体。</p>
<h3 id="Mesh-RecalculateNormals"><a href="#Mesh-RecalculateNormals" class="headerlink" title="Mesh.RecalculateNormals"></a>Mesh.RecalculateNormals</h3><p>重新计算网格的法线<br>在修改完定点后，通常会更新发现来反映新的变化。发现是根据共享的顶点计算出来的。导入到网格有时不共享所有顶点。例如：一个顶点在一个纹理坐标的接缝处将会被分为两个顶点。因此这个RecalculateNormals函数将会在纹理坐标接缝处创建一个不光滑的法线。RecalculateNormals不会自动产生切线，因此bumpmap着色器在调用RecalculateNormals之后不会工作。然而你可以提取你自己的切线。</p>
<h2 id="惯性坐标系"><a href="#惯性坐标系" class="headerlink" title="惯性坐标系"></a>惯性坐标系</h2><p>因为在进行物体到世界坐标系的转换时候，即需要平移同时也需要进行旋转，为了简化这种变化，在其中假如惯性坐标系，其中惯性坐标系的原点与本地坐标系的原点重合其轴和世界坐标系平英。那么本地坐标系到惯性坐标系只需要旋转操作（之前也得缩放）再到世界坐标系只需要进行平移。</p>
<h1 id="构建AssetBundles"><a href="#构建AssetBundles" class="headerlink" title="构建AssetBundles"></a>构建AssetBundles</h1><p>在<a href="https://docs.unity3d.com/Manual/AssetBundles-Workflow.html" target="_blank" rel="noopener">AssetBundle工作流</a>的文档中，我们有一个代码示例，它将三个参数传递给BuildPipeline.BuildAssetBundles函数。让我们更深入实际的了解。<br>Assets/AssetBundles:这是AssetBundles输出的目录。您可以将其更改为您想要的任何输出目录，只需确保在尝试构建之前文件夹实际存在。</p>
<h2 id="BuildAssetBundleOptions"><a href="#BuildAssetBundleOptions" class="headerlink" title="BuildAssetBundleOptions"></a>BuildAssetBundleOptions</h2><p>BuildAssetBundleOptions您可以指定几种具有各种效果的不同。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/12/Unity-Optimize/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/12/Unity-Optimize/" class="post-title-link" itemprop="url">Unity优化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-12 14:51:15" itemprop="dateCreated datePublished" datetime="2018-04-12T14:51:15+08:00">2018-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:38" itemprop="dateModified" datetime="2021-06-17T10:39:38+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>更新不透明贴图的压缩格式为ETC 4bit，因为android市场的手机中的GPU有多种，每家的GPU支持不同的压缩格式，但他们都兼容ETC格式。</li>
<li>对于透明贴图，我们只能选择RGBA 16bit 或者RGBA 32bit。</li>
<li>减少FPS，在ProjectSetting-&gt; Quality中的VSync Count 参数会影响你的FPS，EveryVBlank相当于FPS=60，EverySecondVBlank = 30；<br>这两种情况都不符合游戏的FPS的话，我们需要手动调整FPS，首先关闭垂直同步这个功能，然后在代码的Awake方法里手动设置FPS（Application.targetFrameRate = 45;）<br>降低FPS的好处：<br>1）省电，减少手机发热的情况；<br>2）能都稳定游戏FPS，减少出现卡顿的情况。</li>
<li>当我们设置了FPS后，再调整下Fixed timestep这个参数，这个参数在ProjectSetting-&gt;Time中，目的是减少物理计算的次数，来提高游戏性能。</li>
<li>尽量少使用Update LateUpdate FixedUpdate，这样也可以提升性能和节省电量。多使用事件（不是SendMessage，使用自己写的，或者C#中的事件委托）。</li>
<li>待机时，调整游戏的FPS为1，节省电量。</li>
<li>图集大小最好不要高于1024，否则游戏安装之后、低端机直接崩溃、原因是手机系统版本低于2.2、超过1000的图集无法读取、导致。2.2 以上没有遇见这个情况。注意手机的RAM 与 ROM、小于 512M的手机、直接放弃机型适配。</li>
</ol>
<h2 id="VSCount-垂直同步"><a href="#VSCount-垂直同步" class="headerlink" title="VSCount 垂直同步"></a>VSCount 垂直同步</h2><p>Unity3D中新建一个空场景的时候，帧速率（FPS总是很低），大概在60~70之间。在Unity3D中当运行场景打开Profiler的时候，我们会看到VSync 这一项占了很大的比重。<br>这个是什么呢，这个就是垂直同步。<br>我们可以关闭VSync来提高帧速率，选择edit-&gt;project settings-&gt;Quality。<br>在右侧面板中可以找到VSync Count,把它选成Don’t Sync。<br>这就关闭了VSync(垂直同步)，现在在运行场景看看，帧速率是不是提高很多。<br>现在来说说什么是垂直同步，要知道什么是垂直同步，必须要先明白显示器的工作原理，<br>显示器上的所有图像都是一线一线的扫描上去的，无论是隔行扫描还是逐行扫描，<br>显示器都有两种同步参数——水平同步和垂直同步。</p>
<p>什么叫水平同步？什么叫垂直同步？<br>垂直和水平是CRT中两个基本的同步信号，水平同步信号决定了CRT画出一条横越屏幕线的时间，<br>垂直同步信号决定了CRT从屏幕顶部画到底部，再返回原始位置的时间，<br>而恰恰是垂直同步代表着CRT显示器的刷新率水平。</p>
<p>为什么关闭垂直同步信号会影响游戏中的FPS数值？<br>如果我们选择等待垂直同步信号（也就是我们平时所说的垂直同步打开），<br>那么在游戏中或许强劲的显卡迅速的绘制完一屏的图像，但是没有垂直同步信号的到达，<br>显卡无法绘制下一屏，只有等85单位的信号到达，才可以绘制。<br>这样FPS自然要受到操作系统刷新率运行值的制约。</p>
<p>而如果我们选择不等待垂直同步信号（也就是我们平时所说的关闭垂直同步），那么游戏中作完一屏画面，<br>显卡和显示器无需等待垂直同步信号就可以开始下一屏图像的绘制，自然可以完全发挥显卡的实力。<br>但是不要忘记，正是因为垂直同步的存在，才能使得游戏进程和显示器刷新率同步，使得画面更加平滑和稳定。<br>取消了垂直同步信号，固然可以换来更快的速度，但是在图像的连续性上势必打折扣。<br>这也正是很多朋友抱怨关闭垂直后发现画面不连续的理论原因。</p>
<p>合并材质球Unity3D中每导入一次模型就多一个材质球，可我的这些模型都是共用一张贴图的就想共用一个材质球，所以每次都要删除再附上，很麻烦。怎么才能合并这些材质球？<br>采用TexturePacking吧</p>
<ol>
<li>遍历gameobject，取出material，并根据shader来将material分类；</li>
<li>调用Unity自带的PackTextures函数来合并每个shader分类中的material所对应的textures（PackTextures函数有缺陷，不过可以将就用）；</li>
<li>根据合并的大的texture来更新原有模型的texture、material已经uv坐标值。</li>
</ol>
<p>需要注意的是：需要合并的纹理应该是物体在场景中距离相近的，如果物体在场景中的距离较远，<br>则不建议合并纹理，因为这样做很有可能非但起不到优化的作用，反而降低了运行效率。 </p>
<p>mesh合并<br>分为2种方式合并</p>
<ol>
<li><p>自带的合并必须勾选静态。</p>
<p>所有被勾选了“Static”的GameObject，其中的Mesh Filter中的mesh都会被合并到 “Combined Mesha (root: scene)” 中</p>
</li>
<li><p>也可以用脚本来合并mesh 。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span>  <span class="title">MyClass</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line"></span><br><span class="line">        MeshFilter [] meshFilters = GetComponentsInChildren&lt;MeshFilter&gt; ();</span><br><span class="line">        CombineInstance[] combine = <span class="keyword">new</span> CombineInstance[meshFilters.Length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; meshFilters.Length; i++) </span><br><span class="line">        &#123;</span><br><span class="line">            combine[i].mesh = meshFilters[i].sharedMesh;</span><br><span class="line">            combine[i].transform = meshFilters[i].transform.localToWorldMatrix;</span><br><span class="line">            meshFilters[i].gameObject.active = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        transform.GetComponent&lt;MeshFilter&gt;().mesh = <span class="keyword">new</span> Mesh ();</span><br><span class="line">        transform.GetComponent&lt;MeshFilter&gt;().mesh.CombineMeshes (combine);</span><br><span class="line">        transform.gameObject.active = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>先在 Unity 中建立空物件 ( Empty ) </p>
</li>
<li>再创建2个 Cube 方块，并放入空物件底下 (可以改成你自己的模型)</li>
<li>把 MyClass 代码丟进空物件上 。</li>
<li>(可选) 建立一个 Material 材质，并且丢进空物件上</li>
<li><p>执行</p>
</li>
<li><p>角色Material数量2-3个，骨骼数量小于30个，面片数量300-1500，一般角色应该没有IK结点<br>这是因为角色的动作大多数都是事先设定好的，并不需要经过IK操作来进行实时计算（Rogdoll除外），所以在模型导入时，不要将IK结点一起导入。</p>
</li>
<li>静态实体不要附加Animation Component<br>在静态实体上附加Animation部件虽然对结果没有影响，但却会增加一定的CPU开销来调用这一组件，所以尽量去掉该组件。<br>网格顶点数小于500；UV值范围尽量不要超过（0, 1）区间；尽量保证UV值不越界，这对于将来的纹理拼合优化很有帮助。</li>
<li>地形<br>地形的分辨率大小<br>长宽均尽量小于257。这是因为地形太大，会造成大量顶点数据，给你的内存带宽造成一定的影响，在目前的ios设备中，内存带宽是非常有限的，需要尽量节省。同时，如果用Unity自带的地形，一定也要使用Occlusion Culling，因为Unity的刷地形工具虽然方便，但却是framekiller，刷过之后，你会发现drawcall增加的非常多。<br>混合纹理数量<br>不要超过4。地形的混合操作是很耗时的，应该尽量避免。能合并的纹理尽量合并。</li>
<li>纹理</li>
</ol>
<ul>
<li>纹理格式<br>建议png或tga。不用转成ios硬件支持的PVRTC格式，因为Unity在发布时会帮你自动转的。</li>
<li>纹理尺寸<br>长宽小于1024。同时应该尽可能地小，够用就好，以保证纹理对内存带宽的影响达到最小。</li>
<li>支持Mipmap（UI不需要转，不然会增大内存）<br>建议生成Mipmap。虽然这种做法会增加一些应用程序的大小，但在游戏运行时，系统会根据需求应用Mipmap来渲染，从而减少内存带宽。</li>
<li>检查Alpha值<br>如果纹理的alpha通道均为1，则用RGB的24位纹理来代替RGBA的32位纹理。（据说Unity内部会进行自动检测）</li>
</ul>
<ol>
<li>光源<br>光源“Important”个数建议1个，一般为方向光。“Important”个数应该越小越少。个数越多，drawcall越多。<br>Pixel Light数目1-2个。</li>
<li>粒子特效<br>屏幕上的最大粒子数建议小于200个粒子。<br>每个粒子发射器发射的最大粒子数建议不超过50个。<br>粒子大小如果可以的话，粒子的size应该尽可能地小。因为Unity的粒子系统的shader无论是alpha test还是alpha blending都是一笔不小的开销。同时，对于非常小的粒子，建议粒子纹理去掉alpha通道。<br>尽量不要开启粒子的碰撞功能。<br>非常耗时。</li>
<li>音频<br>游戏中播放时间较长的音乐（如背景音乐）使用.ogg或.mp3的压缩格式。<br>较短音乐（如枪声）使用.wav和.aif的未压缩音频格式。</li>
<li>相机<br>裁剪平面<br>将远平面设置成合适的距离。远平面过大会将一些不必要的物体加入渲染，降低效率。<br>根据不同的物体设置不同的远裁剪平面<br>Unity提供了可以根据不同的layer来设置不同的view distance，所以我们可以实现将物体进行分层，大物体层设置的可视距离大些，而小物体层可以设置地小些，另外，一些开销比较大的实体（如粒子系统）可以设置得更小些等等。</li>
<li>碰撞<br>尽量不用MeshCollider<br>如果可以的话，尽量不用MeshCollider，以节省不必要的开销。如果不能避免的话，尽量用减少Mesh的面片数，或用较少面片的代理体来代替。</li>
<li>其他<br>Drawcall<br>尽可能地减少Drawcall的数量。IOS设备上建议不超过100。减少的方法主要有如下几种：Frustum Culling，Occlusion Culling，Texture Packing。Frustum Culling是Unity内建的，我们需要做的就是寻求一个合适的远裁剪平面；Occlusion Culling，遮挡剔除，Unity内嵌了Umbra，一个非常好OC库。但Occlusion Culling也并不是放之四海而皆准的，有时候进行OC反而比不进行还要慢，建议在OC之前先确定自己的场景是否适合利用OC来优化；Texture Packing，或者叫Texture Atlasing，是将同种shader的纹理进行拼合，根据Unity的static batching的特性来减少draw call。建议使用，但也有弊端，那就是一定要将场景中距离相近的实体纹理进行拼合，否则，拼合后很可能会增加每帧渲染所需的纹理大小，加大内存带宽的负担。这也就是为什么会出现“DrawCall降了，渲染速度也变慢了”的原因。</li>
</ol>
<p>非运动物体尽量打上Static标签<br>Unity在运行时会对static物体进行自动优化处理，所以应该尽可能将非运行实体勾上static标签。</p>
<p>场景中尽可能地使用prefab<br>尽可能地使用prefab的实例化物体，以降低内存带宽的负担。检查实体的PrefabType，尽量将其变成PrefabInstance，而不是ModelPrefabInstance。</p>
<p>移动平台相对于PC机，具有体积小，计算弱，带宽少的特点。</p>
<p>因此做手机游戏的开发，优化的方向，与力度对比PC游戏都有所区别。</p>
<p>必须要做到优化流程，合理利用资源。<br>目前在手机上面，还不能够像PC游戏那样追求高质量渲染效果，为了让手机不那么容易发烫，还要控制cpu，gpu，不能让他们全速运算。</p>
<p>材质方面：<br>纹理方面，建议使用压缩纹理，</p>
<p>Android上面使用ETC1，苹果上面使用PVRTC。<br>UV坐标控制在0到1之间，人物模型面数控制在1500内，骨骼控制在30个以内。<br>场景中使用一个主光（不能再多了）。<br>尽量减少alphaTest和alphaBlend材质的使用。在手机上，这是很杀效率的。<br>骨骼动画方面：<br>在动画方面可以考虑不使用插值，固定的帧率的动画。</p>
<p>如果要做插值，考虑使用四元数（表示旋转）和向量（表示位移）来做插值。</p>
<p>四元数做插值速度比矩阵来的快，Slerp提供了平滑插值。</p>
<p>优化的常规技巧<br>剖析你的游戏。<br>不要花费时间来优化那些晦涩的代码或者缩减图形文件的大小，除非这是你游戏的瓶颈。<br>第一次剖析你的游戏将会使你发现你游戏的瓶颈。Apple’s Shark是一个很好的用来剖析基于OpenGL的程序的工具。<br>再次剖析你的游戏。<br>优化之后不要忘记再剖析一次你的游戏，这样可以检查你所做的优化是否达到了预期的效果。<br>当然，这样做也可能会使你发现更多的瓶颈。<br>流程第一、性能第二。花费时间来使你游戏的创建尽可能地流畅。<br>尽可能快地修正游戏中的错误将会使你后期更容易优化你的游戏。<br>在Scene View中测试场景。<br>这样做将会使你清楚了解这个场景中的物体或者附加在物体上的脚本是否降低了游戏性能。<br>如果Scene View反应迟钝，那么有可能是图形方面的原因，如果Scene View反应不迟钝，那么瓶颈可能出在脚本或者物理系统上。<br>禁用指定游戏物体。<br>在play模式下，尝试禁用并启用游戏物体来排查出游戏慢的原因。</p>
<p>网格<br>如果可能的话，把相邻的物体（网格）合并为一个只有一个材质的物体（网格）。比如，你的游戏中包含一个桌子，上面有一堆东西，你完全可以在3D程序中将它们合并在一起（这可能也需要你将这些物体的纹理合并为一个大的纹理集）。减少需要渲染的物体的数量可以极大地提高游戏性能。</p>
<p>不要有不必要的网格。<br>如果你的游戏场景中有一个人物，那么他应该是一个网格。如果你有一个船，那么它也应该只是一个网格。<br>每一个网格只用一种材质。<br>使用极少的面数的网格（比如500个多边形以下）。<br>最好把你人物的三角面数量控制在1500-2000个之间。<br>这个数量可以说是游戏质量和性能之间一个均衡值。如果你的模型有四边形，那么在导入模型的时候，引擎将会把每个四边形变为两个三角形。</p>
<p>光照<br>像素光。<br>像素光可以让你的游戏看起来效果很牛逼，但是不要使用过多的像素光。<br>在你的游戏中可以使用质量管理器来调节像素光的数量来取得一个性能和质量的均衡点.</p>
<p>性能占用顺序：聚光灯&gt;点光源&gt;平行光。<br>一个好的点亮场景的方法就是先得到你想要的效果，然后看看哪些光更重要；<br>在保持光效的前提下看看哪些光可以去掉。</p>
<p>点光源和聚光灯只影响它们范围内的网格。<br>如果一个网格处于点光源或者聚光灯的照射范围之外，并且光源的attenuate开关是打开的，那么这个网格将不会被光源所影响，这样就可以节省性能开销。<br>这样做理论上来讲可以使用很多小的点光源而且依然能有一个好的性能，因为这些光源只影响一小部分物体。<br>一个网格在有8个以上光源影响的时候，只响应前8个最亮的光源。</p>
<p>贴图<br>在外观不变的前提下，贴图大小越小越好。<br>如果你的显卡的显存不够大的话，你游戏中的贴图将会被转存到系统内存中，在显卡调用它们的时候再传到显卡中。<br>对于比较新的电脑来说，内存和显卡之间有足够的带宽来达到一个很好的性能；<br>如果你很无耻地用了巨多的大图片的话，在低显存的电脑上运行你的游戏的时候，你的游戏必然会挂掉。<br>倒是没有必要在图形编辑软件中调整贴图的大小。你可以在unity导入贴图的时候进行调整。</p>
<p>不要使用低质量的图片。<br>在小播放界面的游戏中使用低质量的jpeg图片或者低色彩的png图片亦或是gif图片没什么问题。<br>在发布游戏的时候，引擎会自动压缩这些图片，多重压缩和解压将会降低图片的质量，所以最好保持贴图文件的分辨率为原始分辨率。<br>这样就会减少多重压缩和解压所导致的图片失真现象。</p>
<p>Shaders<br>多重效果的shader就比看起来样式很单一的shader要更耗费资源。<br>同样在一个拥有贴图和光反射的物体上，使用VertexLit Diffuse shader无疑是最省资源的。</p>
<p>在美术制作场景的过程中，会使用到大量的粒子系统。<br>比如场景中的火把。在我们的一个地下城场景中，美术们放置了大量的火把。整个场景中的各个地方，有100来个火把。</p>
<p>unity中，在摄像机范围外的粒子系统虽然不会被绘制。<br>但是update是一直持续的。这也就意味着，这100多个火把，不论是否可见都在更新。</p>
<p>这个设计应该是很不合理的，在我看过的其他引擎中，都会有一个开关，来控制不可见的粒子系统是否需要update。<br>有的粒子系统在不可见的时候需要更新,比如爆炸。有的不需要更新，比如火堆火把。</p>
<p>为了避免不必要的update开销，尤其是最后游戏是要发布到页游平台（web player只能使用一个cpu的核）。<br>于是写了一个脚本，控制不可见的粒子系统就不更新。</p>
<p>该脚本主要是用到了2个MonoBehaviour的函数。<br>OnBecameInvisible() 当变为不可见   和   OnBecameVisible() 当变成可见。 </p>
<p>要这2个函数起作用的前提是，该GameObject绑定了MeshRender组件。<br>所以，我们要在粒子系统的GameObject放置在一个GameObject  下，且给该GameObject绑定一个MeshRender 与 MeshFilter。<br>MeshFilter中的mesh可以随便找个cube。</p>
<p>在Start（） 的时候，把最GameObject的scale设置为很小，以保证该cube不被看见。<br>其实遍历所有的child，把active设置为false。</p>
<p>在OnBecameVisible 中 遍历所有child，把active设置为true。<br>在OnBecameInvisible中 遍历所有child，把active设置为false。</p>
<p>Unity 性能优化 Draw Call </p>
<p>Unity（或者说基本所有图形引擎）生成一帧画面的处理过程大致可以这样简化描述：引擎首先经过简单的可见性测试，确定摄像机可以看到的物体，然后把这些物体的顶点（包括本地位置、法线、UV等），索引（顶点如何组成三角形），变换（就是物体的位置、旋转、缩放、以及摄像机位置等），相关光源，纹理，渲染方式（由材质/Shader决定）等数据准备好，然后通知图形API——或者就简单地看作是通知GPU——开始绘制，GPU基于这些数据，经过一系列运算，在屏幕上画出成千上万的三角形，最终构成一幅图像。</p>
<p>在Unity中，每次引擎准备数据并通知GPU的过程称为一次Draw Call。这一过程是逐个物体进行的，对于每个物体，不只GPU的渲染，引擎重新设置材质Shader也是一项非常耗时的操作。因此每帧的Draw Call次数是一项非常重要的性能指标，对于iOS来说应尽量控制在20次以内，这个值可以在编辑器的Statistic窗口看到。</p>
<p>Unity内置了Draw Call Batching技术，从名字就可以看出，它的主要目标就是在一次Draw Call中批量处理多个物体。只要物体的变换和材质相同，GPU就可以按完全相同的方式进行处理，即可以把它们放在一个Draw Call中。Draw Call Batching技术的核心就是在可见性测试之后，检查所有要绘制的物体的材质，把相同材质的分为一组（一个Batch），然后把它们组合成一个物体（统一变换），这样就可以在一个Draw Call中处理多个物体了（实际上是组合后的一个物体）。</p>
<p>但Draw Call Batching存在一个缺陷，就是它需要把一个Batch中的所有物体组合到一起，相当于创建了一个与这些物体加起来一样大的物体，与此同时就需要分配相应大小的内存。这不仅会消耗更多内存，还需要消耗CPU时间。特别是对于移动的物体，每一帧都得重新进行组合，这就需要进行一些权衡，否则得不偿失。但对于静止不动的物体来说，只需要进行一次组合，之后就可以一直使用，效率要高得多。</p>
<p>Unity提供了Dynamic Batching和Static Batching两种方式。Dynamic Batching是完全自动进行的，不需要也无法进行任何干预，对于顶点数在300以内的可移动物体，只要使用相同的材质，就会组成Batch。Static Batching则需要把静止的物体标记为Static，然后无论大小，都会组成Batch。如前文所说，Static Batching显然比Dynamic Batching要高效得多</p>
<p>要有效利用Draw Call Batching，首先是尽量减少场景中使用的材质数量，即尽量共享材质，对于仅纹理不同的材质可以把纹理组合到一张更大的纹理中（称为Texture Atlasing）。然后是把不会移动的物体标记为Static。此外还可以通过CombineChildren脚本（Standard Assets/Scripts/Unity Scripts/CombineChildren）手动把物体组合在一起，但这个脚本会影响可见性测试，因为组合在一起的物体始终会被看作一个物体，从而会增加GPU要处理的几何体数量，因此要小心使用。</p>
<p>对于复杂的静态场景，还可以考虑自行设计遮挡剔除算法，减少可见的物体数量同时也可以减少Draw Call。</p>
<p>总之，理解Draw Call和Draw Call Batching原理，根据场景特点设计相应的方案来尽量减少Draw Call次数才是王道，其它方面亦然。</p>
<p>Draw Call Batching （绘制调用批处理）</p>
<p>To draw an object on the screen, the engine has to issue a draw call to the graphics API (OpenGL ES in the case of iOS). Every single draw call requires a significant amount of work on the part of the graphics API, causing significant performance overhead on the CPU side.<br>在屏幕上渲染物体，引擎需要发出一个绘制调用来访问图形API（iOS系统中为OpenGL ES）。<br>每个绘制调用需要进行大量的工作来访问图形API，从而导致了CPU方面显著的性能开销。</p>
<p>Unity combines a number of objects at runtime and draws them together with a single draw call. This operation is called “batching”. The more objects Unity can batch together, the better rendering performance you will get.<br>Unity在运行时可以将一些物体进行合并，从而用一个绘制调用来渲染他们。这一操作，我们称之为“批处理”。<br>一般来说，Unity批处理的物体越多，你就会得到越好的渲染性能。</p>
<p>Built-in batching support in Unity has significant benefit over simply combining geometry in the modeling tool (or using theCombineChildren script from the Standard Assets package). Batching in Unity happensafter visibility determination step. The engine does culling on each object individually, and the amount of rendered geometry is going to be the same as without batching. Combining geometry in the modeling tool, on the other hand, prevents effecient culling and results in much higher amount of geometry being rendered.<br>Unity中内建的批处理机制所达到的效果要明显强于使用几何建模工具（或使用Standard Assets包中的CombineChildren脚本）的批处理效果。<br>这是因为，Unity引擎的批处理操作是在物体的可视裁剪操作之后进行的。<br>Unity先对每个物体进行裁剪，然后再进行批处理，这样可以使渲染的几何总量在批处理前后保持不变。<br>但是，使用几何建模工具来拼合物体，会妨碍引擎对其进行有效的裁剪操作，从而导致引擎需要渲染更多的几何面片。</p>
<p>Materials<br>材质<br>Only objects sharing the same material can be batched together. Therefore, if you want to achieve good batching, you need to share as many materials among different objects as possible.<br>只有拥有相同材质的物体才可以进行批处理。<br>因此，如果你想要得到良好的批处理效果，你需要在程序中尽可能地复用材质和物体。</p>
<p>If you have two identical materials which differ only in textures, you can combine those textures into a single big texture - a process often calledtexture atlasing. Once textures are in the same atlas, you can use single material instead.<br>如果你的两个材质仅仅是纹理不同，那么你可以通过纹理拼合操作来将这两张纹理拼合成一张大的纹理。<br>一旦纹理拼合在一起，你就可以使用这个单一材质来替代之前的两个材质了。</p>
<p>If you need to access shared material properties from the scripts, then it is important to note that modifyingRenderer.material will create a copy of the material. Instead, you should useRenderer.sharedMaterial to keep material shared.<br>如果你需要通过脚本来访问复用材质属性，那么值得注意的是改变Renderer.material将会造成一份材质的拷贝。<br>因此，你应该使用Renderer.sharedMaterial来保证材质的共享状态。</p>
<p>Dynamic Batching<br>动态批处理<br>Unity can automatically batch moving objects into the same draw call if they share the same material.<br>如果动态物体共用着相同的材质，那么Unity会自动对这些物体进行批处理。</p>
<p>Dynamic batching is done automatically and does not require any additional effort on your side.<br>动态批处理操作是自动完成的，并不需要你进行额外的操作。</p>
<p>Tips:<br>提醒：<br>1、Batching dynamic objects has certain overheadper vertex, so batching is applied only to meshes containing less than900 vertex attributes in total.<br>批处理动态物体需要在每个顶点上进行一定的开销，所以动态批处理仅支持小于900顶点的网格物体。</p>
<p>2、If your shader is using Vertex Position, Normal and single UV, then you can batch up to 300 verts and if your shader is using Vertex Position, Normal, UV0, UV1 and Tangent, then only 180 verts.<br>Please note: attribute count limit might be changed in future<br>如果你的着色器使用顶点位置，法线和UV值三种属性，那么你只能批处理300顶点以下的物体；<br>如果你的着色器需要使用顶点位置，法线，UV0，UV1和切向量，那你只能批处理180顶点以下的物体。<br>请注意：属性数量的限制可能会在将来进行改变。</p>
<p>4、Don’t use scale. Objects with scale (1,1,1) and (2,2,2) won’t batch.<br>不要使用缩放尺度（scale）。分别拥有缩放尺度(1,1,1)和(2,2,2)的两个物体将不会进行批处理。</p>
<p>5、Uniformly scaled objects won’t be batched with non-uniformly scaled ones.<br>统一缩放尺度的物体不会与非统一缩放尺度的物体进行批处理。<br>Objects with scale (1,1,1) and (1,2,1) won’t be batched. On the other hand (1,2,1) and (1,3,1) will be.<br>使用缩放尺度(1,1,1)和 (1,2,1)的两个物体将不会进行批处理，但是使用缩放尺度(1,2,1)和(1,3,1)的两个物体将可以进行批处理。</p>
<p>6、Using different material instances will cause batching to fail.<br>使用不同材质的实例化物体（instance）将会导致批处理失败。</p>
<p>7、Objects with lightmaps have additional (hidden) material parameter: offset/scale in lightmap, so lightmapped objects won’t be batched (unless they point to same portions of lightmap)<br>拥有lightmap的物体含有额外（隐藏）的材质属性，比如：lightmap的偏移和缩放系数等。所以，拥有lightmap的物体将不会进行批处理（除非他们指向lightmap的同一部分）。</p>
<p>8、Multi-pass shaders will break batching. E.g. Almost all unity shaders supports several lights in forward rendering, effectively doing additional pass for them<br>多通道的shader会妨碍批处理操作。比如，几乎unity中所有的着色器在前向渲染中都支持多个光源，并为它们有效地开辟多个通道。</p>
<p>9、Using instances of a prefab automatically are using the same mesh and material.<br>预设体的实例会自动地使用相同的网格模型和材质。</p>
<p>Static Batching<br>静态批处理</p>
<p>Static batching, on the other hand, allows the engine to reduce draw calls for geometry of any size (provided it does not move and shares the same material). Static batching is significantly more efficient than dynamic batching. You should choose static batching as it will require less CPU power.<br>相对而言，静态批处理操作允许引擎对任意大小的几何物体进行批处理操作来降低绘制调用（只要这些物体不移动，并且拥有相同的材质）。因此，静态批处理比动态批处理更加有效，你应该尽量低使用它，因为它需要更少的CPU开销。</p>
<p>In order to take advantage of static batching, you need explicitly specify that certain objects are static and willnot move, rotate or scale in the game. To do so, you can mark objects as static using the Static checkbox in the Inspector:<br>为了更好地使用静态批处理，你需要明确指出哪些物体是静止的，并且在游戏中永远不会移动、旋转和缩放。想完成这一步，你只需要在检测器（Inspector）中将Static复选框打勾即可；<br>Using static batching will require additional memory for storing the combined geometry. If several objects shared the same geometry before static batching, then a copy of geometry will be created for each object, either in the Editor or at runtime. This might not always be a good idea - sometimes you will have to sacrifice rendering performance by avoiding static batching for some objects to keep a smaller memory footprint. For example, marking trees as static in a dense forest level can have serious memory impact.<br>使用静态批处理操作需要额外的内存开销来储存合并后的几何数据。在静态批处理之前，如果一些物体共用了同样的几何数据，那么引擎会在编辑以及运行状态对每个物体创建一个几何数据的备份。这并不总是一个好的想法，因为有时候，你将不得不牺牲一点渲染性能来防止一些物体的静态批处理，从而保持较少的内存开销。比如，将浓密森里中树设为Static，会导致严重的内存开销。</p>
<p>Static batching is only available in Unity iOS Advanced.<br>静态批处理目前只支持Unity iOS Advanced。</p>
<p>前两天，MadFinger，就是当今iOS与Android上画质最牛逼闪闪的游戏之一——ShadowGun的开发商，令人惊异地放出了一个ShadowGun的样例关卡以及若干可免费使用的Shader，国外同行们的分享精神真的是令人赞叹不已。原文在这里，以下是我的一些摘录和笔记。</p>
<p>首先是一些优化常识。针对图形方面的优化主要包括三角形数量，纹理所占内存，以及Shader，前两项基本没什么好讲的，针对设备机能的限制制定相应的指标即可，所以Shader就成为了图形性能优化的关键。</p>
<p>Alpha blending</p>
<p>在Unity官方文档中讲，由于硬件原因，在iOS设备上使用alpha-test会造成很大的性能开销，应尽量使用alpha-blend代替。这里提到，在同屏使用alpha-blend的面数，尤其是这些面所占屏幕面积的大小，对性能也会造成很大影响。原因是使用alpha-blend的面会造成overdraw的增加，这尤其对低性能设备的影响很大。不过没有购买Pro版，没有Occlusion Culling功能的话，就不必顾虑这一问题了，反正overdraw是必然的。</p>
<p>复杂的Per-pixel shader</p>
<p>Per-pixel shader即Fragment shader，顾名思义是要对每个渲染到屏幕上的像素做处理的shader，如果per-pixel shader比较复杂且需要处理的像素很多时，也就是使用该shader的面占屏幕面积很大时，对性能的影响甚至要超过alpha blending。因此复杂的per-pixel shader只适用于小物体。</p>
<p>下面是对几个Shader的逐一讲解：</p>
<p>Environment specular maps(Shader Virtual Gloss Per Vertex Additive)<br>Specular map通常都是利用贴图的alpha通道来定义物体表面的光滑程度（反光度），这个shader的特点是per-vertex计算反光度的，有着相当不错的效果的同时比per-pixel的shader性能要高得多。这个shader很适用于关卡环境等占很大区域的模型。</p>
<p>经过优化的动态角色光照和阴影(Light probes和BRDF Shader)<br>传统的Lightmaps无法支持动态物体，对此Unity提供了Light probes技术，预先把动态物体的光照信息保存在代理对象(即Light probes)中，运行时动态物体从距离最近的Probe中获取光照信息。</p>
<p>Unity本身还提供了一个效果非常棒的专为移动设备优化过的角色Shader，支持Diffuse、Specular和Normal maps，并通过一个特殊的脚本生成贴图用于模仿BRDF光照效果。最终产生的效果堪比次时代大作中的角色光影效果。</p>
<p>雾和体积光(Shader Blinking Godrays)<br>目前在移动设备上要开启真正的雾效基本不可行，ShadowGun的方案是通过简单的网格＋透明贴图(称为雾面)来模拟雾效。在玩家靠近时，雾面逐渐变淡，同时fog plane的顶点也会移开(即使完全透明的alpha面也会消耗很多渲染时间)。</p>
<p>使用这个Shader的网格需要经过处理：</p>
<p>顶点的alpha值用于决定顶点是否可以移动(在例子中0为不可动，1为可动)。<br>顶点法线决定移动的方向<br>然后Shader通过计算与观察者的距离来控制雾面的淡入/淡出。<br>这个Shader还可以用来做体积光和其它一些alpha效果。</p>
<p>飞机坠毁的浓烟效果(Shader Scroll 2 Layers Sine Alpha-blended)<br>通过粒子产生浓烟的代价太高，所以ShadowGun中使用了网格＋贴图动画来制作这个效果。通过混合两层贴图并让它们交错移动来产生动画效果。其中顶点alpha值用于让网格的边缘看起来比较柔和，同时使用顶点颜色来模拟从火焰到烟雾的过渡效果。</p>
<p>带动态效果的天空盒(Shader Scroll 2 Layers Multiplicative)<br>通过两张贴图的混合和移动产生云的动态效果。</p>
<p>旗帜和衣服的飘动效果(Shader Lightmap + Wind)<br>同样利用顶点alpha值决定哪些顶点可以移动，然后shader的参数用于调整摆动的方向和速度。</p>
<p>一、程序方面<br>　　1. 务必删除脚本中为空或不需要的默认方法；<br>　　2. 只在一个脚本中使用OnGUI方法；（最好不要加）<br>　 3. 避免在OnGUI中对变量、方法进行更新、赋值，输出变量建议在Update内；<br>　　4. 同一脚本中频繁使用的变量建议声明其为全局变量，脚本之间频繁调用的变量或方法建议声明为全局静态变量或方法；<br>　　5. 不要去频繁获取组件，将其声明为全局变量；<br>　　6. 数组、集合类元素优先使用Array，其次是List；<br>　　7. 脚本在不使用时脚本禁用之，需要时再启用；<br>　　8. 可以使用Ray来代替OnMouseXXX类方法；<br>　　9. 需要隐藏/显示或实例化来回切换的对象，尽量不要使用SetActiveRecursively或active，而使用将对象远远移出相机范围和移回原位的做法；<br>　　10. 尽量少用模运算和除法运算，比如a/5f，一定要写成a * 0.2f。<br>　　11. 对于不经常调用或更改的变量或方法建议使用Coroutines &amp; Yield；<br>　　12. 尽量直接声明脚本变量，而不使用GetComponent来获取脚本；<br>iPhone<br>　　13. 尽量使用整数数字，因为iPhone的浮点数计算能力很差；<br>　　14. 不要使用原生的GUI方法；<br>　　15. 不要实例化（Instantiate）对象，事先建好对象池，并使用Translate“生成”对象；<br>二、模型方面<br>　　1. 合并使用同贴图的材质球，合并使用相同材质球的Mesh；<br>　　2. 角色的贴图和材质球只要一个，若必须多个则将模型离分离为多个部分；<br>　　2. 骨骼系统不要使用太多；<br>　　3. 当使用多角色时，将动画单独分离出来；<br>　　4. 使用层距离来控制模型的显示距离；<br>　　5. 阴影其实包含两方面阴暗和影子，建议使用实时影子时把阴暗效果烘焙出来，不要使用灯光来调节光线阴暗。<br>　　6. 少用像素灯和使用像素灯的Shader；<br>　　7. 如果硬阴影可以解决问题就不要用软阴影，并且使用不影响效果的低分辨率阴影；<br>　　08、实时阴影很耗性能，尽量减小产生阴影的距离；<br>　　09、允许的话在大场景中使用线性雾，这样可以使远距离对象或阴影不易察觉，因此可以通过减小相机和阴影距离来提高性能；<br>　　10、使用圆滑组来尽量减少模型的面数；<br>　　11、项目中如果没有灯光或对象在移动那么就不要使用实时灯光；<br>　　12、水面、镜子等实时反射/折射的效果单独放在Water图层中，并且根据其实时反射/折射的范围来调整；<br>　　13、碰撞对效率的影响很小，但碰撞还是建议使用Box、Sphere碰撞体；<br>　　14、建材质球时尽量考虑使用Substance；<br>　　15、尽量将所有的实时反射/折射（如水面、镜子、地板等等）都集合成一个面；<br>　　16、假反射/折射没有必要使用过大分辨率，一般64<em>64就可以，不建议超过256</em>256；<br>　　17、需要更改的材质球，建议实例化一个，而不是使用公共的材质球；<br>　　18、将不须射线或碰撞事件的对象置于IgnoreRaycast图层；<br>　　19、将水面或类似效果置于Water图层<br>　　20、将透明通道的对象置于TransparentFX图层；<br>　　21、养成良好的标签（Tags）、层次（Hieratchy）和图层（Layer）的条理化习惯，将不同的对象置于不同的标签或图层，三者有效的结合将很方便的按名称、类别和属性来查找；<br>　　22、通过Stats和Profile查看对效率影响最大的方面或对象，或者使用禁用部分模型的方式查看问题到底在哪儿；<br>　　23、使用遮挡剔除（Occlusion Culling）处理大场景，一种较原生的类LOD技术，并且能够“分割”作为整体的一个模型。</p>
<p>三、其它<br>　　场景中如果没有使用灯光和像素灯，就不要使用法线贴图，因为法线效果只有在有光源（Direct Light/Point Light/Angle Light/Pixel Light）的情况下才有效果。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zentia.github.io/2018/04/12/C-Thread-Sync/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liyanfeng">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liyanfeng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/12/C-Thread-Sync/" class="post-title-link" itemprop="url">C# 线程同步</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-12 14:26:42" itemprop="dateCreated datePublished" datetime="2018-04-12T14:26:42+08:00">2018-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-17 10:39:37" itemprop="dateModified" datetime="2021-06-17T10:39:37+08:00">2021-06-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="线程同步的方式"><a href="#线程同步的方式" class="headerlink" title="线程同步的方式"></a>线程同步的方式</h1><p>线程同步有：临界区、互斥区、事件、信号量四种方式</p>
<ol>
<li>临界区(Critical Section)：临界区：通过对多线程的串行化来访问公共资源或一段代码，速度快，适合控制数据访问。在任意时刻只允许一个线程对共享资源进行访问，如果有多个线程试图访问公共资源，那么在有一个线程进入后，其他试图访问公共资源的线程将被挂起，并一直等到进入临界区的线程离开，临界区在被释放后，其他线程才可以抢占。</li>
<li>互斥量(Mutex)：采用互斥对象机制。 只有拥有互斥对象的线程才有访问公共资源的权限，因为互斥对象只有一个，所以能保证公共资源不会同时被多个线程访问。互斥不仅能实现同一应用程序的公共资源安全共享，还能实现不同应用程序的公共资源安全共享 </li>
<li>信号量(Semaphore)：它允许多个线程在同一时刻访问同一资源，但是需要限制在同一时刻访问此资源的最大线程数目 </li>
<li>事件(Event)：通过通知操作的方式来保持线程的同步，还可以方便实现对多个线程的优先级比较的操作</li>
</ol>
<h2 id="lock-关键字"><a href="#lock-关键字" class="headerlink" title="lock 关键字"></a>lock 关键字</h2><p>lock 关键字将语句块标记为临界区，方法是获取给定对象的互斥锁，执行语句，然后释放该锁。<br>lock 确保当一个线程位于代码的临界区时，另一个线程不进入临界区。如果其他线程试图进入锁定的代码，则它将一直等待（即被阻止），直到该对象被释放。</p>
<h2 id="同步事件和等待句柄"><a href="#同步事件和等待句柄" class="headerlink" title="同步事件和等待句柄"></a>同步事件和等待句柄</h2><p>使用锁或监视器对于防止同时执行区分线程的代码块很有用，但是这些构造不允许一个线程向另一个线程传达事件。这需要“同步事件”，它是有两个状态（终止和非终止）的对象，可以用来激活和挂起线程。让线程等待非终止的同步事件可以将线程挂起，将事件状态更改为终止可以将线程激活。如果线程试图等待已经终止的事件，则线程将继续执行，而不会延迟。     </p>
<p>同步事件有两种：AutoResetEvent 和 ManualResetEvent。它们之间唯一的不同在于，无论何时，只要 AutoResetEvent 激活线程，它的状态将自动从终止变为非终止。相反，ManualResetEvent 允许它的终止状态激活任意多个线程，只有当它的 Reset 方法被调用时才还原到非终止状态。</p>
<p>等待句柄，可以通过调用一种等待方法，如WaitOne、WaitAny 或 WaitAll，让线程等待事件。System.Threading.WaitHandle.WaitOne使线程一直等待，直到单个事件变为终止状态；System.Threading.WaitHandle.WaitAny 阻止线程，直到一个或多个指示的事件变为终止状态；System.Threading.WaitHandle.WaitAll 阻止线程，直到所有指示的事件都变为终止状态。当调用事件的 Set 方法时，事件将变为终止状态。</p>
<p>AutoResetEvent 允许线程通过发信号互相通信。 通常，当线程需要独占访问资源时使用该类。线程通过调用 AutoResetEvent 上的 WaitOne 来等待信号。 如果 AutoResetEvent 为非终止状态，则线程会被阻止，并等待当前控制资源的线程通过调用 Set 来通知资源可用。调用 Set 向 AutoResetEvent 发信号以释放等待线程。 AutoResetEvent 将保持终止状态，直到一个正在等待的线程被释放，然后自动返回非终止状态。 如果没有任何线程在等待，则状态将无限期地保持为终止状态。如果当 AutoResetEvent 为终止状态时线程调用 WaitOne，则线程不会被阻止。 AutoResetEvent 将立即释放线程并返回到非终止状态。<br>可以通过将一个布尔值传递给构造函数来控制 AutoResetEvent 的初始状态：如果初始状态为终止状态，则为 true；否则为 false。<br>AutoResetEvent 也可以同 staticWaitAll 和 WaitAny 方法一起使用。</p>
<h2 id="WaitHandle-WaitOne"><a href="#WaitHandle-WaitOne" class="headerlink" title="WaitHandle.WaitOne()"></a>WaitHandle.WaitOne()</h2><p>阻止当前线程，直到当前的 WaitHandle 收到信号为止</p>
<h2 id="EventWaitHandle-Set"><a href="#EventWaitHandle-Set" class="headerlink" title="EventWaitHandle.Set()"></a>EventWaitHandle.Set()</h2><p>将事件状态设置为有信号，从而允许一个或多个等待线程继续执行。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/22/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><a class="extend next" rel="next" href="/page/24/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">liyanfeng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">330</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">97</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liyanfeng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  

    </div>
</body>
</html>
